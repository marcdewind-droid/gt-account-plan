<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grant Thornton EMEA Account Plan | Maki</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --maki-purple: #5845C2;
  --maki-purple-light: #CDC7ED;
  --maki-purple-dark: #3d2f9e;
  --maki-turquoise: #45FFC0;
  --maki-turquoise-light: #C0FFEB;
  --maki-yellow: #E1FF00;
  --maki-yellow-light: #F6FFB2;
  --maki-black: #091010;
  --maki-black-grey: #121818;
  --maki-grey: #F2F0E3;
  --maki-grey-light: #F6F5EF;
  --maki-white: #FFFFFF;
  --shadow-sm: 0 1px 2px rgba(9,16,16,0.06);
  --shadow-md: 0 4px 12px rgba(9,16,16,0.08);
  --shadow-lg: 0 8px 24px rgba(9,16,16,0.12);
  --radius: 12px;
  --radius-sm: 8px;
  --radius-xs: 6px;
  --transition: all 0.2s ease;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--maki-grey-light);
  color: var(--maki-black);
  font-size: 14px;
  line-height: 1.5;
  overflow: hidden;
  height: 100vh;
}

/* ===== LAYOUT ===== */
.app-container {
  display: flex;
  height: 100vh;
}

/* ===== SIDEBAR ===== */
.sidebar {
  width: 260px;
  min-width: 260px;
  background: var(--maki-black);
  color: var(--maki-white);
  display: flex;
  flex-direction: column;
  z-index: 100;
}

.sidebar-logo {
  padding: 24px 24px 20px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
}

.sidebar-logo svg { height: 28px; }

.sidebar-logo .logo-text {
  font-size: 22px;
  font-weight: 700;
  letter-spacing: -0.5px;
  color: var(--maki-white);
}

.sidebar-logo .logo-sub {
  font-size: 11px;
  color: rgba(255,255,255,0.45);
  margin-top: 2px;
  letter-spacing: 0.3px;
  text-transform: uppercase;
}

.sidebar-nav {
  flex: 1;
  padding: 12px;
  overflow-y: auto;
}

.nav-section-label {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: rgba(255,255,255,0.3);
  padding: 16px 12px 6px;
  font-weight: 600;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 12px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: var(--transition);
  color: rgba(255,255,255,0.6);
  font-size: 13px;
  font-weight: 500;
  position: relative;
}

.nav-item:hover {
  background: rgba(255,255,255,0.06);
  color: rgba(255,255,255,0.9);
}

.nav-item.active {
  background: var(--maki-purple);
  color: var(--maki-white);
}

.nav-item .nav-icon {
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 15px;
  flex-shrink: 0;
}

.nav-item .nav-badge {
  margin-left: auto;
  background: rgba(255,255,255,0.15);
  color: rgba(255,255,255,0.7);
  font-size: 10px;
  padding: 2px 7px;
  border-radius: 10px;
  font-weight: 600;
}

.nav-item.active .nav-badge {
  background: rgba(255,255,255,0.2);
  color: var(--maki-white);
}

.sidebar-footer {
  padding: 16px 20px;
  border-top: 1px solid rgba(255,255,255,0.08);
  font-size: 11px;
  color: rgba(255,255,255,0.3);
}

/* ===== MAIN CONTENT ===== */
.main-content {
  flex: 1;
  overflow-y: auto;
  padding: 32px;
}

.page-header {
  margin-bottom: 28px;
}

.page-header h1 {
  font-size: 26px;
  font-weight: 700;
  letter-spacing: -0.5px;
  color: var(--maki-black);
}

.page-header p {
  color: #666;
  margin-top: 4px;
  font-size: 14px;
}

/* ===== CARDS ===== */
.card {
  background: var(--maki-white);
  border-radius: var(--radius);
  box-shadow: var(--shadow-sm);
  border: 1px solid rgba(0,0,0,0.06);
  overflow: hidden;
}

.card-header {
  padding: 18px 22px;
  border-bottom: 1px solid rgba(0,0,0,0.06);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.card-header h3 {
  font-size: 15px;
  font-weight: 600;
  color: var(--maki-black);
}

.card-body { padding: 22px; }

/* ===== METRIC CARDS ===== */
.metrics-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin-bottom: 24px;
}

.metric-card {
  background: var(--maki-white);
  border-radius: var(--radius);
  padding: 20px;
  box-shadow: var(--shadow-sm);
  border: 1px solid rgba(0,0,0,0.06);
}

.metric-card .metric-label {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  color: #888;
  font-weight: 600;
  margin-bottom: 6px;
}

.metric-card .metric-value {
  font-size: 28px;
  font-weight: 700;
  color: var(--maki-black);
  letter-spacing: -1px;
}

.metric-card .metric-sub {
  font-size: 12px;
  color: #888;
  margin-top: 4px;
}

.metric-card.highlight {
  background: var(--maki-purple);
  border-color: var(--maki-purple);
}

.metric-card.highlight .metric-label { color: rgba(255,255,255,0.6); }
.metric-card.highlight .metric-value { color: var(--maki-white); }
.metric-card.highlight .metric-sub { color: rgba(255,255,255,0.6); }

/* ===== STATUS BADGES ===== */
.badge {
  display: inline-flex;
  align-items: center;
  padding: 3px 10px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 0.2px;
}

.badge-live { background: #dcfce7; color: #166534; }
.badge-prospecting { background: #dbeafe; color: #1e40af; }
.badge-researching { background: #fef3c7; color: #92400e; }
.badge-not-started { background: #f3f4f6; color: #6b7280; }
.badge-champion { background: var(--maki-turquoise-light); color: #065f46; }
.badge-decision-maker { background: var(--maki-purple-light); color: var(--maki-purple-dark); }
.badge-influencer { background: var(--maki-yellow-light); color: #713f12; }
.badge-blocker { background: #fee2e2; color: #991b1b; }
.badge-unknown { background: #f3f4f6; color: #6b7280; }

/* ===== RAG STATUS ===== */
.rag { display: inline-block; width: 10px; height: 10px; border-radius: 50%; }
.rag-red { background: #ef4444; }
.rag-amber { background: #f59e0b; }
.rag-green { background: #22c55e; }

/* ===== DASHBOARD GRID ===== */
.dashboard-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-bottom: 24px;
}

.dashboard-grid .full-width {
  grid-column: 1 / -1;
}

/* ===== NEXT ACTIONS TABLE ===== */
.action-table { width: 100%; border-collapse: collapse; }

.action-table th {
  text-align: left;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  color: #888;
  font-weight: 600;
  padding: 8px 12px;
  border-bottom: 1px solid rgba(0,0,0,0.08);
}

.action-table td {
  padding: 10px 12px;
  border-bottom: 1px solid rgba(0,0,0,0.04);
  font-size: 13px;
}

.action-table tr:last-child td { border-bottom: none; }

.action-table tr:hover { background: var(--maki-grey-light); }

.owner-tag {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 600;
  background: var(--maki-purple-light);
  color: var(--maki-purple-dark);
}

.date-tag {
  font-size: 12px;
  color: #888;
  font-weight: 500;
}

.priority-high { color: #ef4444; font-weight: 600; }
.priority-med { color: #f59e0b; font-weight: 600; }
.priority-low { color: #22c55e; font-weight: 600; }

/* ===== ORG MAP ===== */
.org-map-container {
  position: relative;
  overflow: auto;
  min-height: 600px;
  background: var(--maki-grey-light);
  border-radius: var(--radius-sm);
}

.org-map-controls {
  display: flex;
  gap: 8px;
  margin-bottom: 16px;
  flex-wrap: wrap;
}

.org-filter-btn {
  padding: 6px 14px;
  border-radius: 20px;
  border: 1px solid rgba(0,0,0,0.12);
  background: var(--maki-white);
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: var(--transition);
  color: #666;
}

.org-filter-btn:hover { border-color: var(--maki-purple); color: var(--maki-purple); }
.org-filter-btn.active { background: var(--maki-purple); color: white; border-color: var(--maki-purple); }

.org-tree {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 30px 20px;
  min-width: max-content;
}

.org-level {
  display: flex;
  gap: 16px;
  justify-content: center;
  margin-bottom: 12px;
  flex-wrap: wrap;
  position: relative;
}

.org-level::before {
  content: '';
  position: absolute;
  top: -12px;
  left: 50%;
  width: 0;
  height: 12px;
  border-left: 2px solid var(--maki-purple-light);
}

.org-level:first-child::before { display: none; }

.org-entity-group {
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
}

.org-entity-label {
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  color: var(--maki-purple);
  margin-bottom: 10px;
  padding: 4px 14px;
  background: var(--maki-purple-light);
  border-radius: 12px;
}

.org-entity-people {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  justify-content: center;
}

.org-person-card {
  width: 200px;
  background: var(--maki-white);
  border-radius: var(--radius-sm);
  padding: 14px;
  box-shadow: var(--shadow-sm);
  border: 2px solid transparent;
  cursor: pointer;
  transition: var(--transition);
  position: relative;
}

.org-person-card:hover {
  box-shadow: var(--shadow-md);
  transform: translateY(-2px);
}

.org-person-card.tier-1 { border-color: var(--maki-purple); }
.org-person-card.tier-2 { border-color: var(--maki-turquoise); }
.org-person-card.tier-3 { border-color: var(--maki-yellow); }
.org-person-card.tier-4 { border-color: #ddd; }

.org-person-card .person-name {
  font-size: 13px;
  font-weight: 700;
  color: var(--maki-black);
  margin-bottom: 2px;
}

.org-person-card .person-title {
  font-size: 11px;
  color: #666;
  margin-bottom: 8px;
  line-height: 1.3;
}

.org-person-card .person-meta {
  display: flex;
  gap: 4px;
  flex-wrap: wrap;
}

.org-person-card .person-tier {
  position: absolute;
  top: 8px;
  right: 8px;
  width: 22px;
  height: 22px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  font-weight: 700;
  color: white;
}

.tier-1 .person-tier { background: var(--maki-purple); }
.tier-2 .person-tier { background: #0d9488; }
.tier-3 .person-tier { background: #a16207; }
.tier-4 .person-tier { background: #9ca3af; }

/* Relationship status indicator */
.rel-indicator {
  display: flex;
  align-items: center;
  gap: 4px;
  margin-top: 8px;
  font-size: 10px;
  color: #888;
  font-weight: 500;
}

.rel-dot {
  width: 7px;
  height: 7px;
  border-radius: 50%;
}

.rel-sponsor { background: var(--maki-purple); }
.rel-engaged { background: #22c55e; }
.rel-aware { background: #f59e0b; }
.rel-unknown { background: #d1d5db; }

/* ===== PERSON DETAIL PANEL ===== */
.detail-panel-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(9,16,16,0.4);
  z-index: 500;
}

.detail-panel-overlay.open { display: flex; justify-content: flex-end; }

.detail-panel {
  width: 420px;
  background: var(--maki-white);
  height: 100vh;
  overflow-y: auto;
  box-shadow: -4px 0 24px rgba(0,0,0,0.15);
  padding: 28px;
}

.detail-panel .panel-close {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  color: #888;
  float: right;
  padding: 4px;
}

.detail-panel .panel-name {
  font-size: 22px;
  font-weight: 700;
  margin-top: 8px;
  color: var(--maki-black);
}

.detail-panel .panel-title {
  font-size: 14px;
  color: #666;
  margin-bottom: 4px;
}

.detail-panel .panel-entity {
  font-size: 12px;
  color: var(--maki-purple);
  font-weight: 600;
  margin-bottom: 16px;
}

.detail-section {
  margin-bottom: 20px;
}

.detail-section h4 {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  color: #888;
  font-weight: 600;
  margin-bottom: 8px;
}

.detail-section p, .detail-section li {
  font-size: 13px;
  color: #444;
  line-height: 1.6;
}

.detail-section ul {
  list-style: none;
  padding: 0;
}

.detail-section ul li {
  padding: 4px 0;
  padding-left: 12px;
  position: relative;
}

.detail-section ul li::before {
  content: '';
  position: absolute;
  left: 0;
  top: 11px;
  width: 5px;
  height: 5px;
  border-radius: 50%;
  background: var(--maki-purple-light);
}

/* Editable fields */
.editable {
  cursor: text;
  padding: 2px 4px;
  border-radius: 3px;
  transition: var(--transition);
  min-height: 1em;
}

.editable:hover { background: var(--maki-grey-light); }
.editable:focus {
  outline: 2px solid var(--maki-purple);
  background: var(--maki-white);
}

.editable:empty::before {
  content: attr(data-placeholder);
  color: #bbb;
  font-style: italic;
}

/* Edit dropdown */
.edit-select {
  appearance: none;
  border: 1px solid transparent;
  background: transparent;
  font-family: inherit;
  font-size: inherit;
  color: inherit;
  cursor: pointer;
  padding: 2px 4px;
  border-radius: 3px;
}

.edit-select:hover { background: var(--maki-grey-light); border-color: #ddd; }
.edit-select:focus { outline: 2px solid var(--maki-purple); }

/* ===== PIPELINE MINI ===== */
.pipeline-mini {
  display: flex;
  gap: 2px;
  margin-top: 6px;
}

.pipeline-step {
  flex: 1;
  height: 6px;
  border-radius: 3px;
  background: #e5e7eb;
}

.pipeline-step.filled { background: var(--maki-purple); }
.pipeline-step.current { background: var(--maki-turquoise); }

/* ===== COUNTRY STATUS ROW ===== */
.country-row {
  display: flex;
  align-items: center;
  padding: 12px 0;
  border-bottom: 1px solid rgba(0,0,0,0.04);
  gap: 16px;
}

.country-row:last-child { border-bottom: none; }

.country-flag {
  font-size: 20px;
  width: 30px;
  text-align: center;
}

.country-info { flex: 1; }

.country-name {
  font-size: 13px;
  font-weight: 600;
  color: var(--maki-black);
}

.country-detail {
  font-size: 11px;
  color: #888;
}

/* ===== HIDDEN SECTIONS ===== */
.page-section { display: none; }
.page-section.active { display: block; }

/* ===== SCROLLBAR ===== */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: #9ca3af; }

/* ===== CONNECTOR LINES ===== */
.connector-line {
  position: absolute;
  border-left: 2px dashed var(--maki-purple-light);
}

/* ===== ENTITY SECTIONS IN ORG MAP ===== */
.org-entity-section {
  margin-bottom: 28px;
  width: 100%;
}

.org-entity-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 14px;
  padding-bottom: 8px;
  border-bottom: 2px solid var(--maki-purple-light);
}

.org-entity-header h3 {
  font-size: 14px;
  font-weight: 700;
  color: var(--maki-purple);
}

.org-entity-header .entity-count {
  font-size: 11px;
  color: #888;
  background: var(--maki-grey-light);
  padding: 2px 8px;
  border-radius: 10px;
}

.org-people-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 12px;
}

/* ===== REPORTING LINE TREE ===== */
.report-tree {
  padding: 20px;
}

.tree-node {
  margin-left: 24px;
  position: relative;
}

.tree-node::before {
  content: '';
  position: absolute;
  left: -16px;
  top: 0;
  height: 100%;
  border-left: 1px solid var(--maki-purple-light);
}

.tree-node::after {
  content: '';
  position: absolute;
  left: -16px;
  top: 18px;
  width: 12px;
  border-top: 1px solid var(--maki-purple-light);
}

.tree-node:last-child::before { height: 18px; }

.tree-node-content {
  padding: 6px 12px;
  background: var(--maki-white);
  border-radius: var(--radius-xs);
  border: 1px solid rgba(0,0,0,0.06);
  display: inline-flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 4px;
  cursor: pointer;
  transition: var(--transition);
}

.tree-node-content:hover {
  box-shadow: var(--shadow-sm);
  border-color: var(--maki-purple-light);
}

.tree-person-name { font-size: 13px; font-weight: 600; }
.tree-person-title { font-size: 11px; color: #888; }

/* ===== TAB SYSTEM ===== */
.tab-bar {
  display: flex;
  gap: 0;
  border-bottom: 2px solid rgba(0,0,0,0.06);
  margin-bottom: 20px;
}

.tab-btn {
  padding: 10px 20px;
  border: none;
  background: none;
  font-family: inherit;
  font-size: 13px;
  font-weight: 500;
  color: #888;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  margin-bottom: -2px;
  transition: var(--transition);
}

.tab-btn:hover { color: var(--maki-black); }
.tab-btn.active { color: var(--maki-purple); border-bottom-color: var(--maki-purple); font-weight: 600; }

.tab-content { display: none; }
.tab-content.active { display: block; }

/* ===== TOAST NOTIFICATION ===== */
.toast {
  position: fixed;
  bottom: 24px;
  right: 24px;
  background: var(--maki-black);
  color: var(--maki-white);
  padding: 12px 20px;
  border-radius: var(--radius-sm);
  font-size: 13px;
  font-weight: 500;
  box-shadow: var(--shadow-lg);
  z-index: 1000;
  transform: translateY(100px);
  opacity: 0;
  transition: all 0.3s ease;
}

.toast.show { transform: translateY(0); opacity: 1; }

/* ===== LAST UPDATED ===== */
.last-updated {
  font-size: 11px;
  color: #aaa;
  text-align: right;
  margin-bottom: 20px;
}

/* ===== BUILD 2-5 STYLES ===== */
.country-tracker-card {
  background: var(--maki-white);
  border-radius: var(--radius);
  box-shadow: var(--shadow-sm);
  border: 1px solid rgba(0,0,0,0.06);
  padding: 18px 22px;
  margin-bottom: 12px;
  display: grid;
  grid-template-columns: 40px 1fr 140px 140px 120px 100px;
  align-items: center;
  gap: 16px;
  transition: var(--transition);
}
.country-tracker-card:hover { box-shadow: var(--shadow-md); }
.ct-flag { font-size: 24px; }
.ct-name { font-weight: 700; font-size: 14px; }
.ct-sub { font-size: 11px; color: #888; margin-top: 2px; }
.ct-pipeline { display: flex; gap: 2px; height: 8px; }
.ct-pipeline .step { flex:1; border-radius: 4px; background: #e5e7eb; min-width: 14px; }
.ct-pipeline .step.done { background: var(--maki-purple); }
.ct-pipeline .step.active { background: var(--maki-turquoise); }

.revenue-bar { height: 24px; border-radius: 4px; background: var(--maki-purple); min-width: 4px; transition: width 0.5s ease; }
.revenue-row { display: grid; grid-template-columns: 120px 1fr 100px; align-items: center; gap: 12px; padding: 10px 0; border-bottom: 1px solid rgba(0,0,0,0.04); }
.revenue-row:last-child { border-bottom: none; }

.hyp-card {
  background: var(--maki-white);
  border-radius: var(--radius);
  box-shadow: var(--shadow-sm);
  border: 1px solid rgba(0,0,0,0.06);
  margin-bottom: 20px;
  overflow: hidden;
}
.hyp-header { padding: 20px 24px; cursor: pointer; display: flex; align-items: center; justify-content: space-between; }
.hyp-header:hover { background: var(--maki-grey-light); }
.hyp-body { padding: 0 24px 24px; display: none; }
.hyp-body.open { display: block; }
.hyp-section { margin-bottom: 16px; }
.hyp-section h4 { font-size: 11px; text-transform: uppercase; letter-spacing: 0.8px; color: #888; font-weight: 600; margin-bottom: 8px; }
.hyp-pill { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; margin-right: 4px; margin-bottom: 4px; }
.test-result { display: flex; align-items: center; gap: 8px; padding: 6px 0; font-size: 13px; }
.test-pass { color: #166534; }
.test-partial { color: #92400e; }

.risk-row {
  display: grid;
  grid-template-columns: 1fr 90px 90px 60px 1fr 100px;
  align-items: center;
  gap: 12px;
  padding: 14px 22px;
  border-bottom: 1px solid rgba(0,0,0,0.04);
  font-size: 13px;
}
.risk-row:hover { background: var(--maki-grey-light); }
.risk-header { font-size: 10px; text-transform: uppercase; letter-spacing: 0.8px; color: #888; font-weight: 600; }

.comp-card {
  background: var(--maki-white);
  border-radius: var(--radius);
  box-shadow: var(--shadow-sm);
  border: 1px solid rgba(0,0,0,0.06);
  padding: 22px;
  margin-bottom: 16px;
}
.comp-card h3 { font-size: 16px; font-weight: 700; margin-bottom: 4px; }
.comp-card .comp-type { font-size: 11px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px; }
.comp-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }

.proof-card {
  background: var(--maki-white);
  border-radius: var(--radius);
  box-shadow: var(--shadow-sm);
  border: 1px solid rgba(0,0,0,0.06);
  padding: 22px;
}
.proof-stat { font-size: 32px; font-weight: 700; color: var(--maki-purple); letter-spacing: -1px; }
.proof-label { font-size: 12px; color: #888; margin-top: 2px; }

.timeline-item {
  display: flex;
  gap: 16px;
  padding: 14px 22px;
  border-bottom: 1px solid rgba(0,0,0,0.04);
  align-items: flex-start;
}
.timeline-item:hover { background: var(--maki-grey-light); }
.tl-type-icon {
  width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
  font-size: 14px; flex-shrink: 0;
}
.tl-meeting { background: var(--maki-purple-light); color: var(--maki-purple); }
.tl-email { background: #dbeafe; color: #2563eb; }
.tl-linkedin { background: #dbeafe; color: #0077b5; }
.tl-call { background: var(--maki-turquoise-light); color: #065f46; }
.tl-note { background: var(--maki-yellow-light); color: #713f12; }
.tl-content { flex: 1; }
.tl-date { font-size: 11px; color: #888; flex-shrink: 0; min-width: 80px; text-align: right; }
.tl-delete { cursor: pointer; color: #ccc; font-size: 16px; }
.tl-delete:hover { color: #ef4444; }

.action-phase { margin-bottom: 24px; }
.action-phase-header {
  font-size: 13px; font-weight: 700; padding: 10px 16px;
  border-radius: var(--radius-sm) var(--radius-sm) 0 0;
  color: white;
}
.action-item {
  display: grid;
  grid-template-columns: 28px 1fr 100px 100px 90px;
  align-items: center;
  gap: 10px;
  padding: 10px 16px;
  background: var(--maki-white);
  border: 1px solid rgba(0,0,0,0.06);
  border-top: none;
  font-size: 13px;
}
.action-item:last-child { border-radius: 0 0 var(--radius-sm) var(--radius-sm); }
.action-check {
  width: 18px; height: 18px; border-radius: 50%; border: 2px solid #d1d5db;
  cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 11px;
  transition: var(--transition);
}
.action-check.done { background: var(--maki-purple); border-color: var(--maki-purple); color: white; }
.action-check:hover { border-color: var(--maki-purple); }

.raci-table { width: 100%; border-collapse: collapse; }
.raci-table th { font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: #888; font-weight: 600; padding: 10px; text-align: center; border-bottom: 2px solid rgba(0,0,0,0.08); }
.raci-table th:first-child { text-align: left; }
.raci-table td { padding: 10px; text-align: center; border-bottom: 1px solid rgba(0,0,0,0.04); font-size: 13px; }
.raci-table td:first-child { text-align: left; font-weight: 500; }
.raci-table tr:hover { background: var(--maki-grey-light); }
.raci-r { color: var(--maki-purple); font-weight: 700; }
.raci-a { color: #ef4444; font-weight: 700; }
.raci-c { color: #f59e0b; font-weight: 600; }
.raci-i { color: #9ca3af; }
</style>
</head>
<body>

<div class="app-container">
  <!-- SIDEBAR -->
  <nav class="sidebar">
    <div class="sidebar-logo">
      <div class="logo-text" style="color: var(--maki-turquoise);">maki</div>
      <div class="logo-sub">Grant Thornton EMEA</div>
    </div>
    <div class="sidebar-nav">
      <div class="nav-section-label">Overview</div>
      <div class="nav-item active" onclick="showSection('dashboard')">
        <span class="nav-icon">&#9673;</span> Dashboard
      </div>
      <div class="nav-item" onclick="showSection('orgmap')">
        <span class="nav-icon">&#9734;</span> Org Map
        <span class="nav-badge">29</span>
      </div>

      <div class="nav-section-label">Expansion</div>
      <div class="nav-item" onclick="showSection('countries')">
        <span class="nav-icon">&#9788;</span> Country Tracker
        <span class="nav-badge">10</span>
      </div>
      <div class="nav-item" onclick="showSection('revenue')">
        <span class="nav-icon">&#9830;</span> Revenue Model
      </div>

      <div class="nav-section-label">Strategy</div>
      <div class="nav-item" onclick="showSection('hypotheses')">
        <span class="nav-icon">&#10070;</span> Hypotheses
        <span class="nav-badge">3</span>
      </div>
      <div class="nav-item" onclick="showSection('callprep')">
        <span class="nav-icon">&#9742;</span> Call Prep
      </div>

      <div class="nav-section-label">Intelligence</div>
      <div class="nav-item" onclick="showSection('risks')">
        <span class="nav-icon">&#9888;</span> Risk Register
      </div>
      <div class="nav-item" onclick="showSection('competitive')">
        <span class="nav-icon">&#9876;</span> Competitive Intel
      </div>
      <div class="nav-item" onclick="showSection('proofpoints')">
        <span class="nav-icon">&#10004;</span> Proof Points
      </div>

      <div class="nav-section-label">Operations</div>
      <div class="nav-item" onclick="showSection('timeline')">
        <span class="nav-icon">&#8986;</span> Activity Log
      </div>
      <div class="nav-item" onclick="showSection('actionplan')">
        <span class="nav-icon">&#9654;</span> Action Plan
      </div>
      <div class="nav-item" onclick="showSection('raci')">
        <span class="nav-icon">&#9632;</span> Team RACI
      </div>
    </div>
    <div class="sidebar-footer">
      Last saved: <span id="lastSaved">Never</span><br>
      <span style="cursor:pointer; color: var(--maki-turquoise);" onclick="exportData()">Export data</span>
      &nbsp;|&nbsp;
      <span style="cursor:pointer; color: var(--maki-turquoise);" onclick="document.getElementById('importFile').click()">Import</span>
      <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
    </div>
  </nav>

  <!-- MAIN -->
  <div class="main-content">

    <!-- ===== DASHBOARD ===== -->
    <div id="section-dashboard" class="page-section active">
      <div class="page-header">
        <h1>Grant Thornton EMEA</h1>
        <p>Account expansion plan — $8.5B revenue, 80,000+ professionals, 150+ countries</p>
      </div>
      <div class="last-updated">Updated: <span id="dashboardDate">23 Feb 2026</span></div>

      <div class="metrics-grid">
        <div class="metric-card highlight">
          <div class="metric-label">Countries Active</div>
          <div class="metric-value">1 <span style="font-size:16px;opacity:0.6">of 10</span></div>
          <div class="metric-sub">France (live, 3x renewed)</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Contacts Mapped</div>
          <div class="metric-value">29</div>
          <div class="metric-sub">6 entities, 4 tiers</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">France Time Savings</div>
          <div class="metric-value">40-60%</div>
          <div class="metric-sub">Early career screening</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Key Window</div>
          <div class="metric-value">Now</div>
          <div class="metric-sub">New CPO Abigail Fisher starting</div>
        </div>
      </div>

      <div class="dashboard-grid">
        <!-- EXPANSION STATUS -->
        <div class="card">
          <div class="card-header">
            <h3>EMEA Expansion Status</h3>
          </div>
          <div class="card-body">
            <div class="country-row">
              <span class="country-flag">&#127467;&#127479;</span>
              <div class="country-info">
                <div class="country-name">France</div>
                <div class="country-detail">Loriane (contact) &bull; Paul-Louis (owner) &bull; 3x renewed</div>
              </div>
              <span class="badge badge-live">Live</span>
            </div>
            <div class="country-row">
              <span class="country-flag">&#127468;&#127463;</span>
              <div class="country-info">
                <div class="country-name">United Kingdom</div>
                <div class="country-detail">Abigail Fisher (new CPO) &bull; Cinven PE-backed &bull; 160 partner target</div>
              </div>
              <span class="badge badge-prospecting">Prospecting</span>
            </div>
            <div class="country-row">
              <span class="country-flag">&#127470;&#127466;</span>
              <div class="country-info">
                <div class="country-name">Ireland</div>
                <div class="country-detail">Steve Tennant base &bull; GT Advisors platform</div>
              </div>
              <span class="badge badge-researching">Researching</span>
            </div>
            <div class="country-row">
              <span class="country-flag">&#127475;&#127473;</span>
              <div class="country-info">
                <div class="country-name">Netherlands</div>
                <div class="country-detail">Joined GT Advisors May 2025</div>
              </div>
              <span class="badge badge-researching">Researching</span>
            </div>
            <div class="country-row">
              <span class="country-flag">&#127465;&#127466;</span>
              <div class="country-info">
                <div class="country-name">Germany</div>
                <div class="country-detail">~1,500 professionals</div>
              </div>
              <span class="badge badge-not-started">Not Started</span>
            </div>
          </div>
        </div>

        <!-- NEXT ACTIONS (dynamic) -->
        <div class="card">
          <div class="card-header">
            <h3>Critical Next Actions</h3>
          </div>
          <div class="card-body" style="padding: 0;" id="dashboardActions"></div>
        </div>

        <!-- STRATEGIC HYPOTHESES SUMMARY -->
        <div class="card full-width">
          <div class="card-header">
            <h3>Strategic Hypotheses</h3>
          </div>
          <div class="card-body">
            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;">
              <div style="padding:16px;background:var(--maki-purple-light);border-radius:var(--radius-sm);border-left:4px solid var(--maki-purple);">
                <div style="font-size:11px;font-weight:700;text-transform:uppercase;color:var(--maki-purple);margin-bottom:4px;">H1 — Lead with this</div>
                <div style="font-size:14px;font-weight:600;color:var(--maki-black);margin-bottom:6px;">Building One Firm Across EMEA</div>
                <div style="font-size:12px;color:#666;">GT Advisors platform consolidation creates need for unified assessment. France proves the model works.</div>
              </div>
              <div style="padding:16px;background:var(--maki-turquoise-light);border-radius:var(--radius-sm);border-left:4px solid #0d9488;">
                <div style="font-size:11px;font-weight:700;text-transform:uppercase;color:#0d9488;margin-bottom:4px;">H2 — Lead with this</div>
                <div style="font-size:14px;font-weight:600;color:var(--maki-black);margin-bottom:6px;">New CPO Building Modern People Function</div>
                <div style="font-size:12px;color:#666;">Abigail Fisher (first-ever CPO) needs quick wins and data-driven hiring to establish credibility.</div>
              </div>
              <div style="padding:16px;background:var(--maki-yellow-light);border-radius:var(--radius-sm);border-left:4px solid #a16207;">
                <div style="font-size:11px;font-weight:700;text-transform:uppercase;color:#a16207;margin-bottom:4px;">H3 — Explore on call</div>
                <div style="font-size:14px;font-weight:600;color:var(--maki-black);margin-bottom:6px;">Assessment Vendor Consolidation</div>
                <div style="font-size:12px;color:#666;">Fragmented stack (Cappfinity + Kenexa + HireVue) creates cost and experience inconsistency.</div>
              </div>
            </div>
          </div>
        </div>

        <!-- PHASE OVERVIEW -->
        <div class="card full-width">
          <div class="card-header">
            <h3>Expansion Phases</h3>
          </div>
          <div class="card-body">
            <div style="display:flex;gap:0;position:relative;">
              <div style="flex:1;padding:16px 20px;background:var(--maki-purple);color:white;border-radius:var(--radius-sm) 0 0 var(--radius-sm);">
                <div style="font-size:10px;text-transform:uppercase;letter-spacing:0.8px;opacity:0.7;margin-bottom:4px;">Phase 1 &bull; Now — Apr 2026</div>
                <div style="font-size:14px;font-weight:600;margin-bottom:4px;">Arm the Proof</div>
                <div style="font-size:12px;opacity:0.8;">Loriane testimonial, France CHRO endorsement, case study packaging</div>
              </div>
              <div style="flex:1;padding:16px 20px;background:var(--maki-purple-dark);color:white;">
                <div style="font-size:10px;text-transform:uppercase;letter-spacing:0.8px;opacity:0.7;margin-bottom:4px;">Phase 2 &bull; Mar — Jun 2026</div>
                <div style="font-size:14px;font-weight:600;margin-bottom:4px;">Win GT UK</div>
                <div style="font-size:12px;opacity:0.8;">Fisher/Walsh engagement, early careers pilot, Cinven growth narrative</div>
              </div>
              <div style="flex:1;padding:16px 20px;background:var(--maki-black-grey);color:white;">
                <div style="font-size:10px;text-transform:uppercase;letter-spacing:0.8px;opacity:0.7;margin-bottom:4px;">Phase 3 &bull; Jun — Dec 2026</div>
                <div style="font-size:14px;font-weight:600;margin-bottom:4px;">Parallel Expansion</div>
                <div style="font-size:12px;opacity:0.8;">Ireland, Netherlands, Germany — each as independent sale with France + UK proof</div>
              </div>
              <div style="flex:1;padding:16px 20px;background:var(--maki-black);color:white;border-radius:0 var(--radius-sm) var(--radius-sm) 0;">
                <div style="font-size:10px;text-transform:uppercase;letter-spacing:0.8px;opacity:0.7;margin-bottom:4px;">Phase 4 &bull; 2027</div>
                <div style="font-size:14px;font-weight:600;margin-bottom:4px;">EMEA Platform Play</div>
                <div style="font-size:12px;opacity:0.8;">Haynes/Tennant for cross-EMEA standard via GT Advisors</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== ORG MAP ===== -->
    <div id="section-orgmap" class="page-section">
      <div class="page-header">
        <h1>Organisation Map</h1>
        <p>29 contacts across 6 GT entities — click any card for full profile</p>
      </div>

      <div class="org-map-controls">
        <button class="org-filter-btn active" onclick="filterOrg('all')">All Contacts</button>
        <button class="org-filter-btn" onclick="filterOrg('tier-1')">Tier 1 — Decision Makers</button>
        <button class="org-filter-btn" onclick="filterOrg('tier-2')">Tier 2 — Champions</button>
        <button class="org-filter-btn" onclick="filterOrg('tier-3')">Tier 3 — Influencers</button>
        <button class="org-filter-btn" onclick="filterOrg('tier-4')">Tier 4 — Intelligence</button>
        <button class="org-filter-btn" onclick="filterOrg('entity-uk')">UK</button>
        <button class="org-filter-btn" onclick="filterOrg('entity-france')">France</button>
        <button class="org-filter-btn" onclick="filterOrg('entity-advisors')">Advisors</button>
      </div>

      <div class="tab-bar">
        <button class="tab-btn active" onclick="showOrgTab('grid')">Card View</button>
        <button class="tab-btn" onclick="showOrgTab('tree')">Hierarchy Tree</button>
      </div>

      <!-- CARD VIEW -->
      <div id="orgTab-grid" class="tab-content active">
        <div id="orgMapGrid"></div>
      </div>

      <!-- TREE VIEW -->
      <div id="orgTab-tree" class="tab-content">
        <div id="orgTreeView" class="report-tree" style="padding:20px;"></div>
      </div>
    </div>

    <!-- ===== BUILD 2: COUNTRY TRACKER ===== -->
    <div id="section-countries" class="page-section">
      <div class="page-header">
        <h1>Country Tracker</h1>
        <p>Top 10 GT EMEA markets — pipeline maturity, revenue potential, key contacts</p>
      </div>
      <div id="countryTrackerContent"></div>
    </div>

    <!-- ===== BUILD 2: REVENUE MODEL ===== -->
    <div id="section-revenue" class="page-section">
      <div class="page-header">
        <h1>Revenue Model</h1>
        <p>Deal sizing per country based on early career hiring volumes</p>
      </div>
      <div id="revenueModelContent"></div>
    </div>

    <!-- ===== BUILD 3: STRATEGIC HYPOTHESES ===== -->
    <div id="section-hypotheses" class="page-section">
      <div class="page-header">
        <h1>Strategic Hypotheses</h1>
        <p>Three validated hypotheses with conversational moves, pressure testing, and stakeholder mapping</p>
      </div>
      <div id="hypothesesContent"></div>
    </div>

    <!-- ===== BUILD 3: CALL PREP ===== -->
    <div id="section-callprep" class="page-section">
      <div class="page-header">
        <h1>Call Prep Mode</h1>
        <p>Select a stakeholder to get everything you need before a conversation</p>
      </div>
      <div style="margin-bottom:16px;">
        <select id="callPrepSelect" class="edit-select" style="font-size:14px;padding:10px 16px;border:1px solid #ddd;border-radius:var(--radius-sm);width:100%;max-width:400px;background:white;" onchange="renderCallPrep()">
          <option value="">Choose a stakeholder...</option>
        </select>
      </div>
      <div id="callPrepContent"></div>
    </div>

    <!-- ===== BUILD 4: RISK REGISTER ===== -->
    <div id="section-risks" class="page-section">
      <div class="page-header">
        <h1>Risk Register</h1>
        <p>Threats to the deal with probability, impact, mitigation, and RAG status</p>
      </div>
      <div id="riskRegisterContent"></div>
    </div>

    <!-- ===== BUILD 4: COMPETITIVE INTEL ===== -->
    <div id="section-competitive" class="page-section">
      <div class="page-header">
        <h1>Competitive Intelligence</h1>
        <p>Current vendor landscape and displacement strategies per market</p>
      </div>
      <div id="competitiveContent"></div>
    </div>

    <!-- ===== BUILD 4: PROOF POINTS ===== -->
    <div id="section-proofpoints" class="page-section">
      <div class="page-header">
        <h1>Proof Points &amp; Assets</h1>
        <p>France case study, testimonial status, and sales collateral inventory</p>
      </div>
      <div id="proofPointsContent"></div>
    </div>

    <!-- ===== BUILD 5: ACTIVITY TIMELINE ===== -->
    <div id="section-timeline" class="page-section">
      <div class="page-header">
        <h1>Activity Log</h1>
        <p>Chronological interaction log — meetings, emails, LinkedIn, internal notes</p>
      </div>
      <div class="card" style="margin-bottom:16px;">
        <div class="card-header"><h3>Add Activity</h3></div>
        <div class="card-body">
          <div style="display:grid;grid-template-columns:120px 150px 150px 1fr auto;gap:10px;align-items:end;">
            <div>
              <label style="font-size:10px;text-transform:uppercase;letter-spacing:0.5px;color:#888;font-weight:600;">Date</label>
              <input type="date" id="actDate" class="edit-select" style="width:100%;padding:6px;border:1px solid #ddd;border-radius:4px;">
            </div>
            <div>
              <label style="font-size:10px;text-transform:uppercase;letter-spacing:0.5px;color:#888;font-weight:600;">Type</label>
              <select id="actType" class="edit-select" style="width:100%;padding:6px;border:1px solid #ddd;border-radius:4px;">
                <option>Meeting</option><option>Email</option><option>LinkedIn</option><option>Call</option><option>Internal Note</option>
              </select>
            </div>
            <div>
              <label style="font-size:10px;text-transform:uppercase;letter-spacing:0.5px;color:#888;font-weight:600;">Contact</label>
              <input type="text" id="actContact" placeholder="Person name" class="edit-select" style="width:100%;padding:6px;border:1px solid #ddd;border-radius:4px;">
            </div>
            <div>
              <label style="font-size:10px;text-transform:uppercase;letter-spacing:0.5px;color:#888;font-weight:600;">Notes</label>
              <input type="text" id="actNotes" placeholder="What happened..." class="edit-select" style="width:100%;padding:6px;border:1px solid #ddd;border-radius:4px;">
            </div>
            <button onclick="addActivity()" style="padding:6px 16px;background:var(--maki-purple);color:white;border:none;border-radius:var(--radius-xs);cursor:pointer;font-size:13px;font-weight:600;">Add</button>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <h3>Timeline</h3>
          <div style="display:flex;gap:6px;">
            <button class="org-filter-btn active" onclick="filterTimeline('all',this)">All</button>
            <button class="org-filter-btn" onclick="filterTimeline('Meeting',this)">Meetings</button>
            <button class="org-filter-btn" onclick="filterTimeline('Email',this)">Emails</button>
            <button class="org-filter-btn" onclick="filterTimeline('LinkedIn',this)">LinkedIn</button>
            <button class="org-filter-btn" onclick="filterTimeline('Call',this)">Calls</button>
            <button class="org-filter-btn" onclick="filterTimeline('Internal Note',this)">Notes</button>
          </div>
        </div>
        <div class="card-body" id="timelineList" style="padding:0;"></div>
      </div>
    </div>

    <!-- ===== BUILD 5: ACTION PLAN ===== -->
    <div id="section-actionplan" class="page-section">
      <div class="page-header">
        <h1>Action Plan</h1>
        <p>Phased execution plan with owners, dates, and status tracking</p>
      </div>
      <div id="actionPlanContent"></div>
    </div>

    <!-- ===== BUILD 5: TEAM RACI ===== -->
    <div id="section-raci" class="page-section">
      <div class="page-header">
        <h1>Team RACI</h1>
        <p>Responsibility matrix — who owns what across the Maki GT team</p>
      </div>
      <div id="raciContent"></div>
    </div>

  </div>
</div>

<!-- DETAIL PANEL -->
<div id="detailOverlay" class="detail-panel-overlay" onclick="if(event.target===this)closeDetail()">
  <div class="detail-panel">
    <button class="panel-close" onclick="closeDetail()">&times;</button>
    <div id="detailContent"></div>
  </div>
</div>

<!-- TOAST -->
<div id="toast" class="toast"></div>

<script>
// ===== DATA STORE =====
const DATA_KEY = 'maki_gt_account_plan';

const defaultContacts = [
  // GT Advisors / GTIL (Global)
  { id: 1, name: "Hilary Haynes", title: "Global Head of People", entity: "GT Advisors", tier: 1, role: "Decision Maker", relationship: "unknown", country: "Global", linkedin: "", owner: "Marc", notes: "Oversees people strategy across GT Advisors multinational platform. Key for EMEA-wide standardisation play (Phase 4).", hypothesis: "H1", reportsTo: null, email: "" },
  { id: 2, name: "Steve Tennant", title: "COO, GT Advisors", entity: "GT Advisors", tier: 1, role: "Decision Maker", relationship: "unknown", country: "Ireland", linkedin: "", owner: "Marc", notes: "Drives operational integration across Advisors platform. Ireland-based. Key for platform-level procurement.", hypothesis: "H1", reportsTo: null, email: "" },
  { id: 3, name: "Jeanna Shapiro", title: "Chief People & Culture Officer", entity: "GT Advisors", tier: 1, role: "Decision Maker", relationship: "unknown", country: "US", linkedin: "", owner: "", notes: "US-based CPO for Advisors LLC. May influence EMEA people strategy indirectly.", hypothesis: "H1", reportsTo: null, email: "" },

  // GT UK
  { id: 4, name: "Abigail Fisher", title: "Chief People Officer", entity: "GT UK", tier: 1, role: "Decision Maker", relationship: "unknown", country: "UK", linkedin: "", owner: "Marc", notes: "First-ever CPO at GT UK. Starting late Feb 2026. Previously at Deloitte. Narrow 2-6 month window for vendor decisions as she builds her function. PRIMARY TARGET.", hypothesis: "H2", reportsTo: null, email: "" },
  { id: 5, name: "Ruth Walsh", title: "Head of Talent Solutions", entity: "GT UK", tier: 2, role: "Champion", relationship: "unknown", country: "UK", linkedin: "", owner: "Marc", notes: "Runs early careers and graduate programmes. Operational champion — owns the process Maki would improve. Entry point for UK early careers pilot.", hypothesis: "H2,H3", reportsTo: 4, email: "" },
  { id: 6, name: "Fiona Baldwin", title: "Head of Operations", entity: "GT UK", tier: 3, role: "Influencer", relationship: "unknown", country: "UK", linkedin: "", owner: "", notes: "Operations leader. Could influence efficiency-focused vendor decisions.", hypothesis: "H1", reportsTo: null, email: "" },
  { id: 7, name: "Jenn Barnett", title: "Head of ED&I", entity: "GT UK", tier: 3, role: "Influencer", relationship: "unknown", country: "UK", linkedin: "", owner: "", notes: "DEI lead. Maki's bias-reduction capabilities directly relevant. Potential internal advocate.", hypothesis: "H2", reportsTo: 4, email: "" },
  { id: 8, name: "Sarah Kendall", title: "TA Manager, Partner Hiring", entity: "GT UK", tier: 3, role: "Influencer", relationship: "unknown", country: "UK", linkedin: "", owner: "", notes: "Manages partner-level recruitment (160 target). Experienced hire angle — low volume, explore only if organic.", hypothesis: "H3", reportsTo: 5, email: "" },
  { id: 9, name: "Emily Bannon", title: "TA, Early Careers", entity: "GT UK", tier: 4, role: "Intelligence", relationship: "unknown", country: "UK", linkedin: "", owner: "", notes: "Early careers TA team. Ground-level intelligence on current assessment process, pain points, volumes.", hypothesis: "H3", reportsTo: 5, email: "" },

  // GT France
  { id: 10, name: "Loriane", title: "Contact (TA/HR)", entity: "GT France", tier: 2, role: "Champion", relationship: "sponsor", country: "France", linkedin: "", owner: "Paul-Louis", notes: "EXISTING MAKI CUSTOMER. 3x renewed. Reports 40-60% time savings on early career screening. High-scoring candidates received more offers. Video testimonial being arranged. Cannot make cross-country intros due to independent network structure.", hypothesis: "H1,H3", reportsTo: null, email: "" },
  { id: 11, name: "Christelle Le Coustumer", title: "HR Director", entity: "GT France", tier: 1, role: "Decision Maker", relationship: "unknown", country: "France", linkedin: "", owner: "Paul-Louis", notes: "Senior HR leader at GT France. Paul-Louis to confirm if this is the CHRO or if there's someone above. Key for France CHRO endorsement of EMEA expansion.", hypothesis: "H1,H2", reportsTo: null, email: "" },
  { id: 12, name: "Frederic Zeitoun", title: "CEO, GT France", entity: "GT France", tier: 1, role: "Decision Maker", relationship: "unknown", country: "France", linkedin: "", owner: "", notes: "CEO of GT France entity. Executive sponsor level — not primary target but important for strategic alignment if needed.", hypothesis: "H1", reportsTo: null, email: "" },
  { id: 13, name: "Dinah Tebeka", title: "TA Supervisor", entity: "GT France", tier: 4, role: "Intelligence", relationship: "aware", country: "France", linkedin: "", owner: "Paul-Louis", notes: "TA supervisor in France. Likely works with Loriane on recruitment operations.", hypothesis: "H3", reportsTo: 10, email: "" },

  // GT Ireland
  { id: 14, name: "Mia Gargan", title: "Head of People & Culture", entity: "GT Ireland", tier: 2, role: "Champion", relationship: "unknown", country: "Ireland", linkedin: "", owner: "", notes: "People & Culture lead for Ireland. GT Ireland on Advisors platform. Natural Phase 3 target.", hypothesis: "H1,H2", reportsTo: null, email: "" },
  { id: 15, name: "Sandra Cahill", title: "TA Manager", entity: "GT Ireland", tier: 3, role: "Influencer", relationship: "unknown", country: "Ireland", linkedin: "", owner: "", notes: "TA operations in Ireland.", hypothesis: "H3", reportsTo: 14, email: "" },

  // GT Netherlands
  { id: 16, name: "Rens Oliemans", title: "HR Director", entity: "GT Netherlands", tier: 2, role: "Champion", relationship: "unknown", country: "Netherlands", linkedin: "", owner: "", notes: "HR lead for Netherlands. Joined GT Advisors platform May 2025.", hypothesis: "H1,H2", reportsTo: null, email: "" },

  // GT Germany
  { id: 17, name: "Silke Gonsior", title: "Head of HR", entity: "GT Germany", tier: 2, role: "Champion", relationship: "unknown", country: "Germany", linkedin: "", owner: "", notes: "HR lead for Germany. Large market (~1,500 professionals).", hypothesis: "H1,H2", reportsTo: null, email: "" },

  // GT Belgium
  { id: 18, name: "Leslie Van den Branden", title: "Managing Partner & Head of People & Culture", entity: "GT Belgium", tier: 2, role: "Champion", relationship: "unknown", country: "Belgium", linkedin: "", owner: "", notes: "Senior dual role — Managing Partner plus People & Culture. Recently joined Advisors platform.", hypothesis: "H1,H2", reportsTo: null, email: "" },

  // GT Spain
  { id: 19, name: "Ramiro Mata", title: "People Director", entity: "GT Spain", tier: 2, role: "Champion", relationship: "unknown", country: "Spain", linkedin: "", owner: "", notes: "People lead for Spain.", hypothesis: "H1,H2", reportsTo: null, email: "" },

  // GT Nordics
  { id: 20, name: "Anna Svanberg", title: "HR Director", entity: "GT Sweden", tier: 3, role: "Influencer", relationship: "unknown", country: "Sweden", linkedin: "", owner: "", notes: "Nordic market entry point.", hypothesis: "H1", reportsTo: null, email: "" },

  // Additional UK contacts
  { id: 21, name: "Dave Dunckley", title: "CEO, GT UK", entity: "GT UK", tier: 1, role: "Decision Maker", relationship: "unknown", country: "UK", linkedin: "", owner: "", notes: "CEO of GT UK LLP. Cinven PE relationship. Not primary target but important context.", hypothesis: "H1", reportsTo: null, email: "" },
  { id: 22, name: "Mark Jones", title: "Head of Audit", entity: "GT UK", tier: 3, role: "Influencer", relationship: "unknown", country: "UK", linkedin: "", owner: "", notes: "Audit practice leader. Largest hiring volume by service line.", hypothesis: "H3", reportsTo: 21, email: "" },
  { id: 23, name: "Matt Burton", title: "Head of Tax", entity: "GT UK", tier: 3, role: "Influencer", relationship: "unknown", country: "UK", linkedin: "", owner: "", notes: "Tax practice leader. Second largest hiring volume.", hypothesis: "H3", reportsTo: 21, email: "" },

  // MAKI internal team (for RACI tracking)
  { id: 100, name: "Marc de Wind", title: "EMEA Expansion Lead", entity: "Maki (Internal)", tier: 0, role: "Account Lead", relationship: "internal", country: "Internal", linkedin: "", owner: "", notes: "Leading EMEA expansion. Primary relationship owner for UK senior stakeholders.", hypothesis: "", reportsTo: null, email: "marc.dewind@makipeople.com", isInternal: true },
  { id: 101, name: "Paul-Louis", title: "Account Manager", entity: "Maki (Internal)", tier: 0, role: "Account Manager", relationship: "internal", country: "Internal", linkedin: "", owner: "", notes: "Manages GT France relationship. Contact to Loriane. Getting CHRO name and video testimonial.", hypothesis: "", reportsTo: null, email: "", isInternal: true },
  { id: 102, name: "Olly", title: "Team Lead", entity: "Maki (Internal)", tier: 0, role: "Team Lead", relationship: "internal", country: "Internal", linkedin: "", owner: "", notes: "Setting up bi-weekly network account cadence (GT, BDO, PwC, EY). Researching early careers volumes.", hypothesis: "", reportsTo: null, email: "", isInternal: true },
  { id: 103, name: "Brianna", title: "Team Member", entity: "Maki (Internal)", tier: 0, role: "Team Member", relationship: "internal", country: "Internal", linkedin: "", owner: "", notes: "Part of GT account team.", hypothesis: "", reportsTo: null, email: "", isInternal: true },
];

let appData = {
  contacts: [],
  activities: [],
  lastUpdated: new Date().toISOString()
};

function loadData() {
  try {
    const saved = localStorage.getItem(DATA_KEY);
    if (saved) {
      appData = JSON.parse(saved);
      // Merge any new default contacts not in saved data
      const savedIds = new Set(appData.contacts.map(c => c.id));
      defaultContacts.forEach(dc => {
        if (!savedIds.has(dc.id)) appData.contacts.push({...dc});
      });
    } else {
      appData.contacts = defaultContacts.map(c => ({...c}));
    }
  } catch(e) {
    appData.contacts = defaultContacts.map(c => ({...c}));
  }
}

function saveData() {
  appData.lastUpdated = new Date().toISOString();
  try {
    localStorage.setItem(DATA_KEY, JSON.stringify(appData));
    document.getElementById('lastSaved').textContent = new Date().toLocaleString();
    showToast('Changes saved');
  } catch(e) {
    showToast('Save failed — storage full');
  }
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2000);
}

// ===== NAVIGATION =====
function showSection(id) {
  document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('section-' + id).classList.add('active');
  event.currentTarget.classList.add('active');
}

// ===== ORG MAP RENDERING =====
const entityOrder = ['GT Advisors', 'GT UK', 'GT France', 'GT Ireland', 'GT Netherlands', 'GT Germany', 'GT Belgium', 'GT Spain', 'GT Sweden'];
const entityColors = {
  'GT Advisors': '#5845C2',
  'GT UK': '#0d9488',
  'GT France': '#2563eb',
  'GT Ireland': '#16a34a',
  'GT Netherlands': '#ea580c',
  'GT Germany': '#dc2626',
  'GT Belgium': '#7c3aed',
  'GT Spain': '#ca8a04',
  'GT Sweden': '#0284c7',
  'Maki (Internal)': '#45FFC0'
};

let currentFilter = 'all';

function filterOrg(filter) {
  currentFilter = filter;
  document.querySelectorAll('.org-filter-btn').forEach(b => b.classList.remove('active'));
  event.currentTarget.classList.add('active');
  renderOrgMap();
}

function getFilteredContacts() {
  let contacts = appData.contacts.filter(c => !c.isInternal);
  if (currentFilter === 'all') return contacts;
  if (currentFilter.startsWith('tier-')) {
    const tier = parseInt(currentFilter.split('-')[1]);
    return contacts.filter(c => c.tier === tier);
  }
  if (currentFilter.startsWith('entity-')) {
    const entity = currentFilter.replace('entity-', '');
    const map = { 'uk': 'GT UK', 'france': 'GT France', 'advisors': 'GT Advisors' };
    return contacts.filter(c => c.entity === map[entity]);
  }
  return contacts;
}

function renderOrgMap() {
  const contacts = getFilteredContacts();
  const grouped = {};
  contacts.forEach(c => {
    if (!grouped[c.entity]) grouped[c.entity] = [];
    grouped[c.entity].push(c);
  });

  let html = '';
  entityOrder.forEach(entity => {
    const people = grouped[entity];
    if (!people || people.length === 0) return;
    people.sort((a, b) => a.tier - b.tier);

    const color = entityColors[entity] || '#888';
    html += `<div class="org-entity-section">
      <div class="org-entity-header">
        <div style="width:4px;height:20px;background:${color};border-radius:2px;"></div>
        <h3>${entity}</h3>
        <span class="entity-count">${people.length} contacts</span>
      </div>
      <div class="org-people-grid">`;

    people.forEach(p => {
      const relClass = p.relationship === 'sponsor' ? 'rel-sponsor' : p.relationship === 'engaged' ? 'rel-engaged' : p.relationship === 'aware' ? 'rel-aware' : 'rel-unknown';
      const relLabel = p.relationship.charAt(0).toUpperCase() + p.relationship.slice(1);
      const roleClass = p.role === 'Decision Maker' ? 'badge-decision-maker' : p.role === 'Champion' ? 'badge-champion' : p.role === 'Influencer' ? 'badge-influencer' : p.role === 'Blocker' ? 'badge-blocker' : 'badge-unknown';

      html += `<div class="org-person-card tier-${p.tier}" onclick="openDetail(${p.id})">
        <span class="person-tier">T${p.tier}</span>
        <div class="person-name">${p.name}</div>
        <div class="person-title">${p.title}</div>
        <div class="person-meta">
          <span class="badge ${roleClass}">${p.role}</span>
        </div>
        <div class="rel-indicator">
          <span class="rel-dot ${relClass}"></span>
          ${relLabel}
          ${p.owner ? ` &bull; <span style="color:var(--maki-purple);font-weight:600;">${p.owner}</span>` : ''}
        </div>
      </div>`;
    });

    html += '</div></div>';
  });

  document.getElementById('orgMapGrid').innerHTML = html;
  renderOrgTree();
}

function renderOrgTree() {
  const contacts = appData.contacts.filter(c => !c.isInternal);
  // Build tree by entity
  let html = '';

  entityOrder.forEach(entity => {
    const entityContacts = contacts.filter(c => c.entity === entity);
    if (entityContacts.length === 0) return;

    // Find roots (no reportsTo or reportsTo not in this entity)
    const entityIds = new Set(entityContacts.map(c => c.id));
    const roots = entityContacts.filter(c => !c.reportsTo || !entityIds.has(c.reportsTo));
    const children = entityContacts.filter(c => c.reportsTo && entityIds.has(c.reportsTo));

    const color = entityColors[entity] || '#888';
    html += `<div style="margin-bottom:24px;">
      <div style="font-size:13px;font-weight:700;color:${color};margin-bottom:8px;padding:4px 12px;background:${color}15;border-radius:6px;display:inline-block;">${entity}</div>`;

    roots.sort((a,b) => a.tier - b.tier);
    roots.forEach(root => {
      html += renderTreeNode(root, children, 0);
    });

    html += '</div>';
  });

  document.getElementById('orgTreeView').innerHTML = html;
}

function renderTreeNode(person, allChildren, depth) {
  const directReports = allChildren.filter(c => c.reportsTo === person.id);
  const relClass = person.relationship === 'sponsor' ? 'rel-sponsor' : person.relationship === 'engaged' ? 'rel-engaged' : person.relationship === 'aware' ? 'rel-aware' : 'rel-unknown';

  let html = `<div class="${depth > 0 ? 'tree-node' : ''}" style="${depth === 0 ? 'margin-bottom:8px;' : ''}">
    <div class="tree-node-content" onclick="openDetail(${person.id})">
      <span class="rel-dot ${relClass}"></span>
      <span class="tree-person-name">${person.name}</span>
      <span class="tree-person-title">${person.title}</span>
      <span class="badge" style="font-size:9px;padding:1px 6px;background:${person.tier===1?'var(--maki-purple-light)':person.tier===2?'var(--maki-turquoise-light)':person.tier===3?'var(--maki-yellow-light)':'#f3f4f6'};color:${person.tier===1?'var(--maki-purple-dark)':person.tier===2?'#065f46':person.tier===3?'#713f12':'#6b7280'}">T${person.tier}</span>
    </div>`;

  directReports.sort((a,b) => a.tier - b.tier);
  directReports.forEach(dr => {
    html += renderTreeNode(dr, allChildren, depth + 1);
  });

  html += '</div>';
  return html;
}

// ===== ORG TAB SWITCHING =====
function showOrgTab(tab) {
  document.querySelectorAll('#section-orgmap .tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('#section-orgmap .tab-content').forEach(c => c.classList.remove('active'));
  event.currentTarget.classList.add('active');
  document.getElementById('orgTab-' + tab).classList.add('active');
}

// ===== DETAIL PANEL =====
function openDetail(id) {
  const person = appData.contacts.find(c => c.id === id);
  if (!person) return;

  const relOptions = ['unknown', 'aware', 'engaged', 'sponsor'];
  const tierOptions = [1, 2, 3, 4];
  const roleOptions = ['Decision Maker', 'Champion', 'Influencer', 'Blocker', 'Intelligence'];
  const relClass = person.relationship === 'sponsor' ? 'rel-sponsor' : person.relationship === 'engaged' ? 'rel-engaged' : person.relationship === 'aware' ? 'rel-aware' : 'rel-unknown';

  const reportsToName = person.reportsTo ? (appData.contacts.find(c => c.id === person.reportsTo) || {}).name || 'Unknown' : 'None';

  let html = `
    <div class="panel-name">${person.name}</div>
    <div class="panel-title">${person.title}</div>
    <div class="panel-entity" style="color:${entityColors[person.entity] || '#888'};">${person.entity} &bull; ${person.country}</div>

    <div class="detail-section">
      <h4>Relationship Status</h4>
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
        <span class="rel-dot ${relClass}" style="width:10px;height:10px;"></span>
        <select class="edit-select" onchange="updateContact(${id},'relationship',this.value)">
          ${relOptions.map(r => `<option value="${r}" ${r===person.relationship?'selected':''}>${r.charAt(0).toUpperCase()+r.slice(1)}</option>`).join('')}
        </select>
      </div>
    </div>

    <div class="detail-section">
      <h4>Classification</h4>
      <div style="display:flex;gap:12px;flex-wrap:wrap;">
        <div>
          <span style="font-size:11px;color:#888;">Tier:</span>
          <select class="edit-select" onchange="updateContact(${id},'tier',parseInt(this.value))">
            ${tierOptions.map(t => `<option value="${t}" ${t===person.tier?'selected':''}>Tier ${t}</option>`).join('')}
          </select>
        </div>
        <div>
          <span style="font-size:11px;color:#888;">Role:</span>
          <select class="edit-select" onchange="updateContact(${id},'role',this.value)">
            ${roleOptions.map(r => `<option value="${r}" ${r===person.role?'selected':''}>${r}</option>`).join('')}
          </select>
        </div>
      </div>
    </div>

    <div class="detail-section">
      <h4>Maki Owner</h4>
      <div contenteditable="true" class="editable" data-placeholder="Assign owner..." onblur="updateContact(${id},'owner',this.textContent.trim())">${person.owner || ''}</div>
    </div>

    <div class="detail-section">
      <h4>Reports To</h4>
      <div>${reportsToName}</div>
    </div>

    <div class="detail-section">
      <h4>Relevant Hypotheses</h4>
      <div>${person.hypothesis ? person.hypothesis.split(',').map(h => {
        const colors = {'H1':'var(--maki-purple-light)','H2':'var(--maki-turquoise-light)','H3':'var(--maki-yellow-light)'};
        return `<span class="badge" style="background:${colors[h.trim()]||'#f3f4f6'};margin-right:4px;">${h.trim()}</span>`;
      }).join('') : '<span style="color:#aaa;">None assigned</span>'}</div>
    </div>

    <div class="detail-section">
      <h4>LinkedIn</h4>
      <div contenteditable="true" class="editable" data-placeholder="Add LinkedIn URL..." onblur="updateContact(${id},'linkedin',this.textContent.trim())">${person.linkedin || ''}</div>
    </div>

    <div class="detail-section">
      <h4>Email</h4>
      <div contenteditable="true" class="editable" data-placeholder="Add email..." onblur="updateContact(${id},'email',this.textContent.trim())">${person.email || ''}</div>
    </div>

    <div class="detail-section">
      <h4>Intelligence Notes</h4>
      <div contenteditable="true" class="editable" style="min-height:60px;line-height:1.6;" data-placeholder="Add notes..." onblur="updateContact(${id},'notes',this.textContent.trim())">${person.notes || ''}</div>
    </div>

    <div style="margin-top:20px;padding-top:16px;border-top:1px solid rgba(0,0,0,0.06);">
      <button onclick="deleteContact(${id})" style="background:none;border:1px solid #fee2e2;color:#991b1b;padding:6px 14px;border-radius:6px;font-size:12px;cursor:pointer;">Remove Contact</button>
    </div>
  `;

  document.getElementById('detailContent').innerHTML = html;
  document.getElementById('detailOverlay').classList.add('open');
}

function closeDetail() {
  document.getElementById('detailOverlay').classList.remove('open');
}

function updateContact(id, field, value) {
  const contact = appData.contacts.find(c => c.id === id);
  if (contact) {
    contact[field] = value;
    saveData();
    renderOrgMap();
  }
}

function deleteContact(id) {
  if (confirm('Remove this contact from the org map?')) {
    appData.contacts = appData.contacts.filter(c => c.id !== id);
    saveData();
    renderOrgMap();
    closeDetail();
  }
}

// ===== ADD CONTACT =====
function addContact() {
  const maxId = Math.max(...appData.contacts.map(c => c.id), 0);
  const newContact = {
    id: maxId + 1,
    name: "New Contact",
    title: "Title TBC",
    entity: "GT UK",
    tier: 4,
    role: "Intelligence",
    relationship: "unknown",
    country: "UK",
    linkedin: "",
    owner: "",
    notes: "",
    hypothesis: "",
    reportsTo: null,
    email: ""
  };
  appData.contacts.push(newContact);
  saveData();
  renderOrgMap();
  openDetail(newContact.id);
}

// ===== EXPORT / IMPORT =====
function exportData() {
  const blob = new Blob([JSON.stringify(appData, null, 2)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'GT_Account_Plan_' + new Date().toISOString().split('T')[0] + '.json';
  a.click();
  URL.revokeObjectURL(url);
  showToast('Data exported');
}

function importData(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const imported = JSON.parse(e.target.result);
      if (imported.contacts) {
        appData = imported;
        saveData();
        renderOrgMap();
        showToast('Data imported successfully');
      }
    } catch(err) {
      showToast('Import failed — invalid file');
    }
  };
  reader.readAsText(file);
}

// ===== BUILD 2: COUNTRY DATA =====
const pipelineStages = ['Not Started','Researching','Contact ID\'d','First Touch','Meeting Booked','Discovery','Proposal','Pilot','Live'];

const defaultCountries = [
  { id:'FR', flag:'\u{1F1EB}\u{1F1F7}', name:'France', stage:'Live', headcount:2200, earlyCareerEst:150, ats:'Recruitee (migrating)', keyContact:'Loriane', owner:'Paul-Louis', estARR:18000, notes:'3x renewed. 40-60% time savings. Video testimonial in progress.' },
  { id:'UK', flag:'\u{1F1EC}\u{1F1E7}', name:'United Kingdom', stage:'First Touch', headcount:5500, earlyCareerEst:500, ats:'Workday', keyContact:'Abigail Fisher', owner:'Marc', estARR:60000, notes:'New CPO starting Feb 2026. Cinven PE-backed. 160 partner target. Largest opportunity.' },
  { id:'IE', flag:'\u{1F1EE}\u{1F1EA}', name:'Ireland', stage:'Researching', headcount:3000, earlyCareerEst:200, ats:'Unknown', keyContact:'Mia Gargan', owner:'TBC', estARR:24000, notes:'Steve Tennant base. GT Advisors platform member.' },
  { id:'NL', flag:'\u{1F1F3}\u{1F1F1}', name:'Netherlands', stage:'Researching', headcount:1200, earlyCareerEst:100, ats:'Unknown', keyContact:'Rens Oliemans', owner:'TBC', estARR:12000, notes:'Joined GT Advisors May 2025.' },
  { id:'DE', flag:'\u{1F1E9}\u{1F1EA}', name:'Germany', stage:'Not Started', headcount:1500, earlyCareerEst:120, ats:'Unknown', keyContact:'Silke Gonsior', owner:'TBC', estARR:14400, notes:'Large market. Regulatory considerations for AI in hiring.' },
  { id:'BE', flag:'\u{1F1E7}\u{1F1EA}', name:'Belgium', stage:'Not Started', headcount:800, earlyCareerEst:60, ats:'Unknown', keyContact:'Leslie Van den Branden', owner:'TBC', estARR:7200, notes:'Managing Partner + People & Culture dual role. Recently joined Advisors platform.' },
  { id:'ES', flag:'\u{1F1EA}\u{1F1F8}', name:'Spain', stage:'Not Started', headcount:900, earlyCareerEst:70, ats:'Unknown', keyContact:'Ramiro Mata', owner:'TBC', estARR:8400, notes:'People Director identified.' },
  { id:'SE', flag:'\u{1F1F8}\u{1F1EA}', name:'Sweden', stage:'Not Started', headcount:600, earlyCareerEst:40, ats:'Unknown', keyContact:'Anna Svanberg', owner:'TBC', estARR:4800, notes:'Nordic entry point.' },
  { id:'IT', flag:'\u{1F1EE}\u{1F1F9}', name:'Italy', stage:'Not Started', headcount:700, earlyCareerEst:50, ats:'Unknown', keyContact:'TBC', owner:'TBC', estARR:6000, notes:'Contact research needed.' },
  { id:'PL', flag:'\u{1F1F5}\u{1F1F1}', name:'Poland', stage:'Not Started', headcount:500, earlyCareerEst:40, ats:'Unknown', keyContact:'TBC', owner:'TBC', estARR:4800, notes:'Growing market. Contact research needed.' }
];

function renderCountryTracker() {
  if (!appData.countries) appData.countries = defaultCountries.map(c => ({...c}));
  let html = '';
  const sorted = [...appData.countries].sort((a,b) => pipelineStages.indexOf(b.stage) - pipelineStages.indexOf(a.stage));
  sorted.forEach(c => {
    const stageIdx = pipelineStages.indexOf(c.stage);
    let pipelineHtml = pipelineStages.map((s,i) => {
      const cls = i < stageIdx ? 'step done' : i === stageIdx ? 'step active' : 'step';
      return `<div class="${cls}" title="${s}"></div>`;
    }).join('');
    html += `<div class="country-tracker-card" style="grid-template-columns:40px 1fr;">
      <span class="ct-flag">${c.flag}</span>
      <div>
        <div class="ct-name">${c.name}</div>
        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:8px;">
          <div>
            <div style="font-size:10px;color:#888;text-transform:uppercase;letter-spacing:0.5px;">Pipeline Stage</div>
            <select class="edit-select" style="font-size:12px;padding:3px 6px;border:1px solid #ddd;border-radius:4px;width:100%;" onchange="updateCountry('${c.id}','stage',this.value)">
              ${pipelineStages.map(s => `<option ${s===c.stage?'selected':''}>${s}</option>`).join('')}
            </select>
            <div class="ct-pipeline" style="margin-top:4px;">${pipelineHtml}</div>
          </div>
          <div>
            <div style="font-size:10px;color:#888;text-transform:uppercase;letter-spacing:0.5px;">Headcount</div>
            <div contenteditable="true" class="editable" style="font-size:13px;font-weight:600;" onblur="updateCountry('${c.id}','headcount',parseInt(this.textContent)||0)">${c.headcount.toLocaleString()}</div>
            <div style="font-size:10px;color:#888;margin-top:2px;">Early career est:</div>
            <div contenteditable="true" class="editable" style="font-size:12px;" onblur="updateCountry('${c.id}','earlyCareerEst',parseInt(this.textContent)||0)">${c.earlyCareerEst}</div>
          </div>
          <div>
            <div style="font-size:10px;color:#888;text-transform:uppercase;letter-spacing:0.5px;">Key Contact</div>
            <div contenteditable="true" class="editable" style="font-size:12px;font-weight:600;" onblur="updateCountry('${c.id}','keyContact',this.textContent.trim())">${c.keyContact}</div>
            <div style="font-size:10px;color:#888;margin-top:4px;">Owner:</div>
            <div contenteditable="true" class="editable" style="font-size:12px;font-weight:600;color:var(--maki-purple);" onblur="updateCountry('${c.id}','owner',this.textContent.trim())">${c.owner}</div>
          </div>
          <div>
            <div style="font-size:10px;color:#888;text-transform:uppercase;letter-spacing:0.5px;">ATS</div>
            <div contenteditable="true" class="editable" style="font-size:12px;" onblur="updateCountry('${c.id}','ats',this.textContent.trim())">${c.ats}</div>
            <div style="font-size:10px;color:#888;margin-top:4px;">Est. ARR:</div>
            <div contenteditable="true" class="editable" style="font-size:12px;font-weight:600;" onblur="updateCountry('${c.id}','estARR',parseInt(this.textContent.replace(/[^0-9]/g,''))||0)">\u20AC${c.estARR.toLocaleString()}</div>
          </div>
        </div>
        <div style="margin-top:6px;">
          <div style="font-size:10px;color:#888;text-transform:uppercase;letter-spacing:0.5px;">Notes</div>
          <div contenteditable="true" class="editable" style="font-size:12px;color:#444;min-height:1.2em;" data-placeholder="Add notes..." onblur="updateCountry('${c.id}','notes',this.textContent.trim())">${c.notes}</div>
        </div>
      </div>
    </div>`;
  });
  document.getElementById('countryTrackerContent').innerHTML = html;
}

function updateCountry(id, field, value) {
  const c = appData.countries.find(x => x.id === id);
  if (c) { c[field] = value; saveData(); renderCountryTracker(); }
}

// ===== BUILD 2: REVENUE MODEL =====
function renderRevenueModel() {
  if (!appData.countries) appData.countries = defaultCountries.map(c => ({...c}));
  const maxARR = Math.max(...appData.countries.map(c => c.estARR));
  const totalARR = appData.countries.reduce((s,c) => s + c.estARR, 0);
  const liveARR = appData.countries.filter(c => c.stage === 'Live').reduce((s,c) => s + c.estARR, 0);
  const pipelineARR = appData.countries.filter(c => c.stage !== 'Live' && c.stage !== 'Not Started').reduce((s,c) => s + c.estARR, 0);

  let html = `<div class="metrics-grid" style="margin-bottom:20px;">
    <div class="metric-card highlight">
      <div class="metric-label">Total Addressable</div>
      <div class="metric-value">\u20AC${(totalARR/1000).toFixed(0)}K</div>
      <div class="metric-sub">Across 10 EMEA markets</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Live ARR</div>
      <div class="metric-value">\u20AC${(liveARR/1000).toFixed(0)}K</div>
      <div class="metric-sub">France (confirmed)</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Active Pipeline</div>
      <div class="metric-value">\u20AC${(pipelineARR/1000).toFixed(0)}K</div>
      <div class="metric-sub">Researching + Prospecting</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Pricing Basis</div>
      <div class="metric-value" contenteditable="true" class="editable" onblur="appData.pricingBasis=parseInt(this.textContent.replace(/[^0-9]/g,''))||120;saveData();renderRevenueModel()">\u20AC${appData.pricingBasis || 120}</div>
      <div class="metric-sub">Est. per candidate assessed</div>
    </div>
  </div>
  <div class="card"><div class="card-header"><h3>Revenue by Country (Est. Annual)</h3></div><div class="card-body">
    <div style="font-size:11px;color:#888;margin-bottom:12px;">Based on estimated early career volumes \u00D7 \u20AC${appData.pricingBasis || 120}/candidate. Click any Est. ARR value in Country Tracker to adjust.</div>`;

  const sorted = [...appData.countries].sort((a,b) => b.estARR - a.estARR);
  sorted.forEach(c => {
    const pct = (c.estARR / maxARR) * 100;
    const stageClass = c.stage === 'Live' ? 'badge-live' : c.stage === 'Not Started' ? 'badge-not-started' : 'badge-prospecting';
    html += `<div class="revenue-row">
      <div style="font-size:13px;font-weight:600;">${c.flag} ${c.name}</div>
      <div style="position:relative;">
        <div class="revenue-bar" style="width:${pct}%;${c.stage==='Live'?'background:#22c55e;':''}"></div>
      </div>
      <div style="text-align:right;">
        <span style="font-size:14px;font-weight:700;">\u20AC${(c.estARR/1000).toFixed(1)}K</span>
        <span class="badge ${stageClass}" style="margin-left:6px;">${c.stage}</span>
      </div>
    </div>`;
  });
  html += '</div></div>';
  document.getElementById('revenueModelContent').innerHTML = html;
}

// ===== BUILD 3: HYPOTHESES =====
const hypothesesData = [
  {
    id: 'H1', label: 'LEAD WITH THIS', color: 'var(--maki-purple)', lightColor: 'var(--maki-purple-light)',
    title: 'Building One Firm Across EMEA',
    summary: 'GT Advisors is consolidating independent member firms onto a single multinational platform. This creates a once-in-a-generation opportunity to standardise talent assessment across EMEA \u2014 and France already proves the model works.',
    pillars: ['GT Advisors platform consolidating EMEA firms','Cinven PE investment demanding operational efficiency','France demonstrates Maki ROI within the network','Independent firms need a common assessment language'],
    causalChain: 'PE investment \u2192 Platform consolidation \u2192 Need for operational standardisation \u2192 Assessment fragmentation visible \u2192 France proof point available \u2192 Maki as the unifying layer',
    tests: [
      { name: 'Specificity', result: 'pass', detail: 'Names GT Advisors platform, Cinven investment, specific EMEA firms joining' },
      { name: 'Falsifiability', result: 'pass', detail: 'Would fail if GT Advisors reverses integration, or firms resist standardisation' },
      { name: 'So-What', result: 'pass', detail: 'Without unified assessment, GT risks inconsistent talent quality across newly integrated firms' },
      { name: 'Timing', result: 'pass', detail: 'Platform consolidation happening NOW (Netherlands May 2025, more firms joining)' },
      { name: 'Commercial Anchor', result: 'pass', detail: 'Multi-country deal vs single-country = 5-10x revenue multiplier' }
    ],
    openingQuestions: [
      '"As you bring more firms onto the Advisors platform, how are you thinking about standardising the people processes across different countries?"',
      '"Your colleagues in France have been using Maki for three years \u2014 has there been any discussion about extending that across the network?"'
    ],
    conversationalMoves: [
      'Start with their integration challenges, not your product',
      'Use France as proof that a common approach works within GT',
      'Acknowledge the independence of each firm \u2014 position Maki as enabling consistency without forcing uniformity',
      'Anchor to Cinven/PE growth narrative \u2014 they need efficient, scalable processes'
    ],
    stakeholders: ['Hilary Haynes','Steve Tennant','Abigail Fisher','Loriane']
  },
  {
    id: 'H2', label: 'LEAD WITH THIS', color: '#0d9488', lightColor: 'var(--maki-turquoise-light)',
    title: 'New CPO Building a Modern People Function',
    summary: 'Abigail Fisher is GT UK\'s first-ever Chief People Officer, starting late February 2026. She needs quick wins and data-driven tools to establish credibility. Maki gives her a visible, measurable transformation in hiring quality.',
    pillars: ['First-ever CPO role signals strategic elevation of people function','Fisher from Deloitte \u2014 accustomed to data-driven, tech-enabled HR','90-day window to demonstrate impact and set vendor strategy','Early careers is highest volume, most visible quick win'],
    causalChain: 'New CPO appointment \u2192 Need for quick wins \u2192 Early careers = highest volume + most visible \u2192 Current process manual/fragmented \u2192 Maki provides data + efficiency \u2192 Fisher gets measurable improvement to present to board',
    tests: [
      { name: 'Specificity', result: 'pass', detail: 'Names Fisher, her start date, her Deloitte background, first-ever CPO' },
      { name: 'Falsifiability', result: 'pass', detail: 'Would fail if Fisher deprioritises hiring tech, or inherits locked vendor contracts' },
      { name: 'So-What', result: 'pass', detail: 'Without modern tools, Fisher risks looking like she hasn\'t changed anything \u2014 dangerous for a new CPO' },
      { name: 'Timing', result: 'pass', detail: 'She starts NOW. 90-day honeymoon period is the window' },
      { name: 'Commercial Anchor', result: 'pass', detail: 'UK early careers alone worth est. \u20AC60K ARR. Beachhead for experienced hires later' }
    ],
    openingQuestions: [
      '"Congratulations on the new role. As you\'re shaping your priorities, how are you thinking about the talent acquisition infrastructure you\'ve inherited?"',
      '"When you look at the early careers process \u2014 which I imagine is your highest volume \u2014 what would you want to change first?"'
    ],
    conversationalMoves: [
      'Lead with empathy for the new-role challenge, not a pitch',
      'Position Maki as helping HER succeed, not as a vendor sale',
      'Reference her Deloitte background \u2014 she\'ll expect data-driven approaches',
      'Don\'t raise experienced hires unless she does \u2014 keep focus on early careers'
    ],
    stakeholders: ['Abigail Fisher','Ruth Walsh','Jenn Barnett']
  },
  {
    id: 'H3', label: 'EXPLORE ON CALL', color: '#a16207', lightColor: 'var(--maki-yellow-light)',
    title: 'Assessment Vendor Consolidation',
    summary: 'GT UK currently uses Cappfinity (aptitude), IBM Kenexa (psychometric), and HireVue (video interviews) \u2014 three separate vendors for candidate assessment. This creates cost duplication, inconsistent candidate experience, and data silos.',
    pillars: ['Three overlapping assessment vendors = cost and complexity','No unified candidate data across assessment stages','Candidate experience fragmented across multiple platforms','Maki consolidates all three into one platform'],
    causalChain: 'Multiple vendors \u2192 Higher cost + admin burden \u2192 Inconsistent candidate experience \u2192 Data locked in silos \u2192 Can\'t optimise hiring funnel \u2192 Maki replaces 3 with 1',
    tests: [
      { name: 'Specificity', result: 'pass', detail: 'Names Cappfinity, Kenexa, HireVue specifically' },
      { name: 'Falsifiability', result: 'pass', detail: 'Would fail if GT is happy with current stack, or contracts are long-term' },
      { name: 'So-What', result: 'partial', detail: 'Vendor consolidation is a nice-to-have, not urgent. May not drive executive action alone' },
      { name: 'Timing', result: 'partial', detail: 'Depends on contract renewal cycles we don\'t know yet' },
      { name: 'Commercial Anchor', result: 'pass', detail: 'Consolidation = cost savings narrative + higher per-deal value' }
    ],
    openingQuestions: [
      '"I\'m curious \u2014 with Cappfinity, Kenexa, and HireVue each doing different parts of assessment, how does your team manage the candidate journey across those platforms?"',
      '"If you could wave a magic wand and have one unified view of every candidate\'s assessment data, what would that unlock for you?"'
    ],
    conversationalMoves: [
      'Only explore this if H1 or H2 has landed \u2014 don\'t lead with vendor displacement',
      'Use as a supporting argument, not the primary narrative',
      'Focus on candidate experience, not cost \u2014 cost alone rarely drives urgency',
      'Ask about contract renewal timing to gauge feasibility'
    ],
    stakeholders: ['Ruth Walsh','Sarah Kendall','Emily Bannon']
  }
];

function renderHypotheses() {
  if (!appData.hypotheses) appData.hypotheses = JSON.parse(JSON.stringify(hypothesesData));
  let html = '';
  appData.hypotheses.forEach((h, hIdx) => {
    const testHtml = h.tests.map((t, tIdx) => {
      const icon = t.result === 'pass' ? '\u2705' : '\u{1F7E1}';
      const cls = t.result === 'pass' ? 'test-pass' : 'test-partial';
      return `<div class="test-result ${cls}">
        <span style="cursor:pointer;" onclick="appData.hypotheses[${hIdx}].tests[${tIdx}].result=appData.hypotheses[${hIdx}].tests[${tIdx}].result==='pass'?'partial':'pass';saveData();renderHypotheses()">${icon}</span>
        <strong>${t.name}:</strong>
        <span contenteditable="true" class="editable" onblur="appData.hypotheses[${hIdx}].tests[${tIdx}].detail=this.textContent.trim();saveData()">${t.detail}</span>
      </div>`;
    }).join('');

    html += `<div class="hyp-card">
      <div class="hyp-header" onclick="this.nextElementSibling.classList.toggle('open')">
        <div style="display:flex;align-items:center;gap:12px;">
          <span class="hyp-pill" style="background:${h.lightColor};color:${h.color};">${h.id}</span>
          <span contenteditable="true" class="editable" style="font-size:10px;text-transform:uppercase;letter-spacing:0.8px;font-weight:700;color:${h.color};" onclick="event.stopPropagation()" onblur="appData.hypotheses[${hIdx}].label=this.textContent.trim();saveData()">${h.label}</span>
          <span contenteditable="true" class="editable" style="font-size:16px;font-weight:700;" onclick="event.stopPropagation()" onblur="appData.hypotheses[${hIdx}].title=this.textContent.trim();saveData()">${h.title}</span>
        </div>
        <span style="color:#ccc;font-size:18px;">\u25BC</span>
      </div>
      <div class="hyp-body">
        <div class="hyp-section">
          <h4>Summary</h4>
          <div contenteditable="true" class="editable" style="font-size:13px;color:#444;line-height:1.6;min-height:2em;" onblur="appData.hypotheses[${hIdx}].summary=this.textContent.trim();saveData()">${h.summary}</div>
        </div>
        <div class="hyp-section">
          <h4>Validation Pillars</h4>
          ${h.pillars.map((p, pIdx) => `<div style="padding:4px 0 4px 14px;font-size:13px;color:#444;position:relative;"><span style="position:absolute;left:0;top:10px;width:6px;height:6px;border-radius:50%;background:${h.lightColor};"></span><span contenteditable="true" class="editable" onblur="appData.hypotheses[${hIdx}].pillars[${pIdx}]=this.textContent.trim();saveData()">${p}</span></div>`).join('')}
        </div>
        <div class="hyp-section">
          <h4>Causal Chain</h4>
          <div contenteditable="true" class="editable" style="padding:12px 16px;background:var(--maki-grey-light);border-radius:var(--radius-xs);font-size:12px;color:#444;font-family:monospace;line-height:1.8;min-height:2em;" onblur="appData.hypotheses[${hIdx}].causalChain=this.textContent.trim();saveData()">${h.causalChain}</div>
        </div>
        <div class="hyp-section">
          <h4>Pressure Tests</h4>
          ${testHtml}
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
          <div class="hyp-section">
            <h4>Opening Questions</h4>
            ${h.openingQuestions.map((q, qIdx) => `<div contenteditable="true" class="editable" style="padding:8px 12px;background:var(--maki-grey-light);border-radius:var(--radius-xs);font-size:12px;color:#444;margin-bottom:6px;font-style:italic;line-height:1.5;min-height:1.5em;" onblur="appData.hypotheses[${hIdx}].openingQuestions[${qIdx}]=this.textContent.trim();saveData()">${q}</div>`).join('')}
          </div>
          <div class="hyp-section">
            <h4>Conversational Moves</h4>
            ${h.conversationalMoves.map((m, mIdx) => `<div style="padding:4px 0 4px 14px;font-size:12px;color:#444;position:relative;line-height:1.5;"><span style="position:absolute;left:0;top:8px;width:5px;height:5px;border-radius:50%;background:${h.lightColor};"></span><span contenteditable="true" class="editable" onblur="appData.hypotheses[${hIdx}].conversationalMoves[${mIdx}]=this.textContent.trim();saveData()">${m}</span></div>`).join('')}
          </div>
        </div>
        <div class="hyp-section">
          <h4>Key Stakeholders</h4>
          <div contenteditable="true" class="editable" style="font-size:12px;" onblur="appData.hypotheses[${hIdx}].stakeholders=this.textContent.trim().split(',').map(s=>s.trim());saveData()">${h.stakeholders.join(', ')}</div>
        </div>
      </div>
    </div>`;
  });
  document.getElementById('hypothesesContent').innerHTML = html;
}

// ===== BUILD 3: CALL PREP =====
const callPrepData = {
  4: { // Fisher
    context: 'First-ever CPO at GT UK, starting late Feb 2026. Previously at Deloitte. Building her team and strategy from scratch.',
    whyNow: 'She\'s in her first 90 days. Vendor decisions she makes now will define her function for years. She needs quick wins to establish credibility with the board.',
    leadWith: 'H2 (New CPO Building Modern People Function)',
    dontMention: 'Experienced hires / partner recruitment. Low volume, low ROI. Only discuss if SHE raises it.',
    objections: [
      { obj: '"We already have assessment tools in place"', response: 'Acknowledge them, then ask how she feels about the candidate data they provide. Cappfinity/Kenexa/HireVue are separate systems with no unified view.' },
      { obj: '"I need to understand the current state before making changes"', response: 'Completely fair. Offer Maki as a pilot alongside existing tools \u2014 no need to replace anything yet. Let the data speak.' },
      { obj: '"Budget is tight with Cinven\'s cost focus"', response: 'Frame Maki as cost consolidation, not new spend. Three vendors \u2192 one. Plus efficiency gains from France (40-60% time savings).' }
    ],
    nextStepAsk: 'Discovery meeting with Ruth Walsh (Head of Talent Solutions) to map the early careers assessment process.',
    proofPoints: 'GT France: 3x renewed, 40-60% time savings, high-scoring candidates received more offers. Same network, same type of firm.'
  },
  5: { // Walsh
    context: 'Head of Talent Solutions at GT UK. Runs early careers and graduate programmes. Operational leader who owns the hiring process day-to-day.',
    whyNow: 'New CPO (Fisher) will want to understand what\'s working and what isn\'t. Walsh can either be the one presenting problems or presenting solutions.',
    leadWith: 'H3 (Vendor Consolidation) as operational reality, supported by H2 (new CPO opportunity)',
    dontMention: 'GT Advisors platform strategy \u2014 too strategic for her level. Keep it practical.',
    objections: [
      { obj: '"Cappfinity works fine for us"', response: 'Ask about the full journey. Cappfinity does aptitude, but what about personality, situational judgement, candidate experience? Is she getting unified data?' },
      { obj: '"We don\'t have time to implement something new"', response: 'Maki deploys in 2-3 weeks, not months. And GT France went live quickly \u2014 Paul-Louis can share their experience.' }
    ],
    nextStepAsk: 'A 30-minute walkthrough of how Maki works for early careers, using GT France\'s actual setup as the demo.',
    proofPoints: 'GT France: same firm type, same early careers challenge, 40-60% screening time reduction, quality improvement validated by offer data.'
  },
  10: { // Loriane
    context: 'Existing Maki customer at GT France. 3x renewed. Our strongest advocate in the GT network.',
    whyNow: 'Video testimonial is being arranged. CHRO endorsement needed. She\'s the proof that makes every other GT conversation credible.',
    leadWith: 'Gratitude and partnership \u2014 this is a relationship nurture, not a sales call.',
    dontMention: 'Don\'t put pressure on her for cross-country intros. She\'s confirmed she CAN\'T do that due to network structure.',
    objections: [
      { obj: '"I\'m not sure I can help with other countries"', response: 'Completely understood. What WOULD help is if she\'s willing to be referenced \u2014 a testimonial video, a quote, or being available for a reference call.' }
    ],
    nextStepAsk: 'Confirm timeline for video testimonial. Ask if her CHRO would be open to a brief endorsement quote.',
    proofPoints: 'She IS the proof point. Focus on making her story easy to share.'
  },
  1: { // Haynes
    context: 'Global Head of People at GT Advisors. Oversees people strategy across the multinational platform.',
    whyNow: 'GT Advisors is actively bringing new firms onto the platform. People processes need standardisation.',
    leadWith: 'H1 (Building One Firm) \u2014 this is her remit exactly.',
    dontMention: 'Don\'t lead with product. Lead with her strategic challenge. She\'s C-level, not operational.',
    objections: [
      { obj: '"Each firm manages their own HR"', response: 'Absolutely, and that autonomy is important. But is there an opportunity for shared tools that each firm can configure locally? France is already using Maki \u2014 that\'s an organic proof point within your network.' },
      { obj: '"We have bigger priorities right now"', response: 'Understood. Ask what those priorities are \u2014 there may be an intersection. If not, plant the seed and follow up in 3 months.' }
    ],
    nextStepAsk: 'Would she be open to hearing how GT France has been using assessment technology? 15 minutes, no commitment.',
    proofPoints: 'GT France 3x renewed. Proven within their own network. Not asking her to take a bet \u2014 the pilot already happened.'
  }
};

function renderCallPrep() {
  const select = document.getElementById('callPrepSelect');
  if (select.options.length <= 1) {
    const extContacts = appData.contacts.filter(c => !c.isInternal).sort((a,b) => a.tier - b.tier);
    extContacts.forEach(c => {
      const opt = document.createElement('option');
      opt.value = c.id;
      opt.textContent = `${c.name} \u2014 ${c.title} (${c.entity})`;
      select.appendChild(opt);
    });
  }
  const id = parseInt(select.value);
  if (!id) { document.getElementById('callPrepContent').innerHTML = '<div class="card"><div class="card-body" style="text-align:center;padding:40px;color:#aaa;">Select a stakeholder above to load call prep</div></div>'; return; }

  const person = appData.contacts.find(c => c.id === id);

  // Store call prep in appData so edits persist
  if (!appData.callPrep) appData.callPrep = JSON.parse(JSON.stringify(callPrepData));
  const prep = appData.callPrep[id];

  if (!prep) {
    // No pre-built prep — show editable blank template
    appData.callPrep[id] = { context: person.notes || '', whyNow: '', leadWith: '', dontMention: '', objections: [], nextStepAsk: '', proofPoints: '' };
    saveData();
  }
  const p = appData.callPrep[id];

  let objHtml = (p.objections||[]).map((o, oIdx) => `<div style="margin-bottom:12px;">
    <div contenteditable="true" class="editable" style="font-size:12px;font-weight:600;color:#991b1b;margin-bottom:4px;" onblur="appData.callPrep[${id}].objections[${oIdx}].obj=this.textContent.trim();saveData()">${o.obj}</div>
    <div contenteditable="true" class="editable" style="font-size:12px;color:#444;padding-left:12px;border-left:3px solid var(--maki-purple-light);min-height:1.5em;" onblur="appData.callPrep[${id}].objections[${oIdx}].response=this.textContent.trim();saveData()">${o.response}</div>
  </div>`).join('');

  document.getElementById('callPrepContent').innerHTML = `
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
      <div class="card">
        <div class="card-header"><h3>Context &mdash; ${person.name}</h3></div>
        <div class="card-body">
          <div class="hyp-section"><h4>Who They Are</h4><div contenteditable="true" class="editable" style="font-size:13px;color:#444;line-height:1.6;min-height:2em;" data-placeholder="Add context..." onblur="appData.callPrep[${id}].context=this.textContent.trim();saveData()">${p.context}</div></div>
          <div class="hyp-section"><h4>Why Now</h4><div contenteditable="true" class="editable" style="font-size:13px;color:#444;line-height:1.6;min-height:2em;" data-placeholder="Why is now the right time..." onblur="appData.callPrep[${id}].whyNow=this.textContent.trim();saveData()">${p.whyNow}</div></div>
          <div class="hyp-section"><h4>Lead With</h4><div contenteditable="true" class="editable" style="padding:10px 14px;background:var(--maki-purple-light);border-radius:var(--radius-xs);font-size:13px;font-weight:600;color:var(--maki-purple-dark);min-height:1.5em;" data-placeholder="Which hypothesis to lead with..." onblur="appData.callPrep[${id}].leadWith=this.textContent.trim();saveData()">${p.leadWith}</div></div>
          <div class="hyp-section"><h4 style="color:#991b1b;">Don't Mention</h4><div contenteditable="true" class="editable" style="padding:10px 14px;background:#fee2e2;border-radius:var(--radius-xs);font-size:13px;color:#991b1b;min-height:1.5em;" data-placeholder="Topics to avoid..." onblur="appData.callPrep[${id}].dontMention=this.textContent.trim();saveData()">${p.dontMention}</div></div>
        </div>
      </div>
      <div>
        <div class="card" style="margin-bottom:16px;">
          <div class="card-header"><h3>Objection Handling</h3></div>
          <div class="card-body">
            ${objHtml}
            <button onclick="addObjection(${id})" style="padding:4px 12px;background:none;border:1px dashed #ccc;border-radius:4px;cursor:pointer;font-size:11px;color:#888;">+ Add objection</button>
          </div>
        </div>
        <div class="card" style="margin-bottom:16px;">
          <div class="card-header"><h3>Next Step Ask</h3></div>
          <div class="card-body"><div contenteditable="true" class="editable" style="padding:12px 16px;background:var(--maki-turquoise-light);border-radius:var(--radius-xs);font-size:13px;font-weight:600;color:#065f46;min-height:1.5em;" data-placeholder="What's the ask..." onblur="appData.callPrep[${id}].nextStepAsk=this.textContent.trim();saveData()">${p.nextStepAsk}</div></div>
        </div>
        <div class="card">
          <div class="card-header"><h3>Proof Points to Use</h3></div>
          <div class="card-body"><div contenteditable="true" class="editable" style="font-size:13px;color:#444;line-height:1.6;min-height:2em;" data-placeholder="Key proof points..." onblur="appData.callPrep[${id}].proofPoints=this.textContent.trim();saveData()">${p.proofPoints}</div></div>
        </div>
      </div>
    </div>`;
}

function addObjection(personId) {
  if (!appData.callPrep[personId].objections) appData.callPrep[personId].objections = [];
  appData.callPrep[personId].objections.push({ obj:'"New objection"', response:'Response TBC' });
  saveData(); renderCallPrep();
}

// ===== BUILD 4: RISK REGISTER =====
const defaultRisks = [
  { id:1, risk:'Fisher deprioritises hiring tech in first 90 days', probability:'Medium', impact:'High', rag:'amber', mitigation:'Build relationship with Ruth Walsh as parallel entry. Walsh can champion even if Fisher is distracted.', owner:'Marc' },
  { id:2, risk:'Cinven PE pressure freezes vendor spend', probability:'Low', impact:'High', rag:'amber', mitigation:'Position Maki as consolidation (3 vendors to 1 = cost saving). Frame as efficiency investment, not new spend.', owner:'Marc' },
  { id:3, risk:'Cappfinity has multi-year contract in UK', probability:'Medium', impact:'Medium', rag:'amber', mitigation:'Run Maki as pilot alongside Cappfinity. Don\'t require displacement upfront. Let data prove superiority.', owner:'Marc' },
  { id:4, risk:'ATS integration block prevents deployment', probability:'Low', impact:'Medium', rag:'green', mitigation:'Maki works standalone. France operates without ATS integration. Position as feature, not bug \u2014 faster deployment.', owner:'Paul-Louis' },
  { id:5, risk:'Paul-Louis leaves and France relationship weakens', probability:'Low', impact:'High', rag:'amber', mitigation:'Document all France intel. Ensure Marc/Olly have backup relationships. Get CHRO endorsement as institutional anchor.', owner:'Olly' },
  { id:6, risk:'GT firms resist standardisation / protect independence', probability:'High', impact:'Medium', rag:'amber', mitigation:'Never position as top-down mandate. Each country gets their own deal, own config. Use "shared toolkit" language, not "standard process".', owner:'Marc' },
  { id:7, risk:'German AI-in-hiring regulations create compliance blockers', probability:'Medium', impact:'Medium', rag:'amber', mitigation:'Research EU AI Act implications for assessment. Prepare compliance documentation. May need to delay Germany entry.', owner:'Olly' },
  { id:8, risk:'Competitor (HireVue/Cappfinity) offers GT EMEA enterprise deal', probability:'Low', impact:'High', rag:'red', mitigation:'Speed is our defence. Lock in UK pilot before competitors react. France relationship is our moat.', owner:'Marc' }
];

function renderRiskRegister() {
  if (!appData.risks) appData.risks = defaultRisks.map(r => ({...r}));
  let html = `<div class="card"><div class="card-body" style="padding:0;overflow-x:auto;">
    <div class="risk-row" style="background:var(--maki-grey-light);border-radius:var(--radius) var(--radius) 0 0;">
      <div class="risk-header">Risk</div>
      <div class="risk-header">Probability</div>
      <div class="risk-header">Impact</div>
      <div class="risk-header">RAG</div>
      <div class="risk-header">Mitigation</div>
      <div class="risk-header">Owner</div>
    </div>`;
  appData.risks.forEach(r => {
    html += `<div class="risk-row">
      <div contenteditable="true" class="editable" style="font-weight:500;" onblur="updateRisk(${r.id},'risk',this.textContent.trim())">${r.risk}</div>
      <div><select class="edit-select" onchange="updateRisk(${r.id},'probability',this.value)">
        <option ${r.probability==='Low'?'selected':''}>Low</option><option ${r.probability==='Medium'?'selected':''}>Medium</option><option ${r.probability==='High'?'selected':''}>High</option>
      </select></div>
      <div><select class="edit-select" onchange="updateRisk(${r.id},'impact',this.value)">
        <option ${r.impact==='Low'?'selected':''}>Low</option><option ${r.impact==='Medium'?'selected':''}>Medium</option><option ${r.impact==='High'?'selected':''}>High</option>
      </select></div>
      <div><select class="edit-select" onchange="updateRisk(${r.id},'rag',this.value)">
        <option value="green" ${r.rag==='green'?'selected':''}>\u{1F7E2}</option><option value="amber" ${r.rag==='amber'?'selected':''}>\u{1F7E1}</option><option value="red" ${r.rag==='red'?'selected':''}>\u{1F534}</option>
      </select></div>
      <div contenteditable="true" class="editable" style="font-size:12px;color:#444;" onblur="updateRisk(${r.id},'mitigation',this.textContent.trim())">${r.mitigation}</div>
      <div contenteditable="true" class="editable" style="font-size:12px;font-weight:600;color:var(--maki-purple-dark);" onblur="updateRisk(${r.id},'owner',this.textContent.trim())">${r.owner}</div>
    </div>`;
  });
  // Add new risk button
  html += `<div style="padding:12px 22px;"><button onclick="addRisk()" style="padding:6px 14px;background:var(--maki-purple);color:white;border:none;border-radius:var(--radius-xs);cursor:pointer;font-size:12px;font-weight:600;">+ Add Risk</button></div>`;
  html += '</div></div>';
  document.getElementById('riskRegisterContent').innerHTML = html;
}

function updateRisk(id, field, value) {
  const r = appData.risks.find(x => x.id === id);
  if (r) { r[field] = value; saveData(); }
}

function addRisk() {
  if (!appData.risks) appData.risks = [];
  const maxId = Math.max(...appData.risks.map(r => r.id), 0);
  appData.risks.push({ id: maxId+1, risk:'New risk', probability:'Medium', impact:'Medium', rag:'amber', mitigation:'TBC', owner:'TBC' });
  saveData(); renderRiskRegister();
}

// ===== BUILD 4: COMPETITIVE INTEL =====
function renderCompetitive() {
  if (!appData.competitors) {
    appData.competitors = [
      { id:1, name:'Cappfinity', type:'Aptitude & Strengths Assessment', presence:'UK (confirmed), likely Ireland',
        strengths:'Established at GT UK. Strengths-based assessment aligned with GT brand. Incumbent advantage.',
        weaknesses:'Single-dimension (aptitude only). No psychometric or video. Separate data silo. Traditional UI.',
        displacement:'Don\'t attack directly. Position Maki as complementary initially, then let breadth of capability make Cappfinity redundant. Ask "what data do you get from Cappfinity that helps you make decisions?"',
        makiAdvantage:'Full-stack assessment (aptitude + personality + situational + AI screening) vs single dimension. Unified candidate data. Modern candidate experience.' },
      { id:2, name:'IBM Kenexa', type:'Psychometric Assessment', presence:'UK (confirmed)',
        strengths:'IBM brand credibility. Deep psychometric science. Enterprise procurement relationship.',
        weaknesses:'Aging platform. Slow innovation. Enterprise sales cycles. Often bundled with other IBM products GT may not want.',
        displacement:'Position as "same psychometric rigour, modern delivery". Maki\'s Ken product has IO psychologist-designed assessments. Ask about their renewal timeline.',
        makiAdvantage:'Modern UX vs legacy interface. Faster deployment. Not locked into IBM ecosystem. Better candidate experience.' },
      { id:3, name:'HireVue', type:'Video Interview & AI Assessment', presence:'UK (confirmed)',
        strengths:'Strong brand in video interviewing. AI-powered assessment. Good enterprise penetration.',
        weaknesses:'Privacy/bias controversies around AI video analysis. Expensive per-interview pricing. Candidate experience concerns.',
        displacement:'Maki\'s Mochi (voice AI screening) is a direct competitor but with better candidate experience. Position around the controversy \u2014 "structured conversation vs being analysed by camera". Ask how candidates feel about HireVue.',
        makiAdvantage:'Mochi is conversational AI, not surveillance AI. Better candidate perception. Integrated with full assessment suite rather than standalone.' },
      { id:4, name:'Workday', type:'ATS / HRIS Platform', presence:'UK (confirmed). Global block on ATS integration reported.',
        strengths:'Enterprise HRIS. Single source of truth for employee data. Deep GT UK integration.',
        weaknesses:'Assessment capabilities are basic. Not a specialist assessment tool. Integration with 3rd party assessment tools can be clunky.',
        displacement:'Don\'t compete with Workday \u2014 complement it. Position Maki as the assessment layer that feeds better data INTO Workday. Note: global ATS integration block means standalone deployment is actually the path of least resistance.',
        makiAdvantage:'Maki works standalone without ATS integration. France proves this model works. When integration opens up, Maki has standard ATS connectors ready.' }
    ];
  }
  let html = '<div class="comp-grid">';
  appData.competitors.forEach(v => {
    html += `<div class="comp-card">
      <h3 contenteditable="true" class="editable" onblur="updateCompetitor(${v.id},'name',this.textContent.trim())">${v.name}</h3>
      <div class="comp-type" contenteditable="true" class="editable" onblur="updateCompetitor(${v.id},'type',this.textContent.trim())">${v.type}</div>
      <div style="margin-bottom:12px;" contenteditable="true" class="editable" onblur="updateCompetitor(${v.id},'presence',this.textContent.trim())">${v.presence}</div>
      <div class="hyp-section"><h4>Strengths</h4><div contenteditable="true" class="editable" style="font-size:12px;color:#444;line-height:1.5;min-height:1.5em;" onblur="updateCompetitor(${v.id},'strengths',this.textContent.trim())">${v.strengths}</div></div>
      <div class="hyp-section"><h4>Weaknesses</h4><div contenteditable="true" class="editable" style="font-size:12px;color:#444;line-height:1.5;min-height:1.5em;" onblur="updateCompetitor(${v.id},'weaknesses',this.textContent.trim())">${v.weaknesses}</div></div>
      <div class="hyp-section"><h4 style="color:var(--maki-purple);">Displacement Strategy</h4><div contenteditable="true" class="editable" style="font-size:12px;color:#444;line-height:1.5;min-height:1.5em;" onblur="updateCompetitor(${v.id},'displacement',this.textContent.trim())">${v.displacement}</div></div>
      <div class="hyp-section"><h4 style="color:#065f46;">Maki Advantage</h4><div contenteditable="true" class="editable" style="font-size:12px;color:#065f46;line-height:1.5;font-weight:500;min-height:1.5em;" onblur="updateCompetitor(${v.id},'makiAdvantage',this.textContent.trim())">${v.makiAdvantage}</div></div>
    </div>`;
  });
  html += '<div style="margin-top:12px;"><button onclick="addCompetitor()" style="padding:6px 14px;background:var(--maki-purple);color:white;border:none;border-radius:var(--radius-xs);cursor:pointer;font-size:12px;font-weight:600;">+ Add Competitor</button></div>';
  html += '</div>';
  document.getElementById('competitiveContent').innerHTML = html;
}

function updateCompetitor(id, field, value) {
  const c = appData.competitors.find(x => x.id === id);
  if (c) { c[field] = value; saveData(); }
}

function addCompetitor() {
  const maxId = Math.max(...appData.competitors.map(c => c.id), 0);
  appData.competitors.push({ id:maxId+1, name:'New Competitor', type:'Category', presence:'TBC', strengths:'TBC', weaknesses:'TBC', displacement:'TBC', makiAdvantage:'TBC' });
  saveData(); renderCompetitive();
}

// ===== BUILD 4: PROOF POINTS =====
function renderProofPoints() {
  if (!appData.proofPoints) {
    appData.proofPoints = {
      stats: [
        { id:1, value:'40-60%', label:'Screening time reduction at GT France' },
        { id:2, value:'3x', label:'Contract renewals (France)' },
        { id:3, value:'\u2191 Offers', label:'High-scoring Maki candidates received more offers' },
        { id:4, value:'Early Careers', label:'Proven use case: high volume, similar CVs' }
      ],
      caseStudy: {
        challenge: 'High volume early career recruitment with similar CVs making screening time-intensive. GT less prestigious than Big 4, needs to cast wider net across broader institutions.',
        solution: 'Maki Shiro for early funnel assessment. Automated screening of candidates before human review. Deployed standalone without ATS integration.',
        results: '40-60% reduction in screening time. High-scoring candidates received more offers (quality validated). Three contract renewals. Loriane describes as essential to their process.',
        keyInsight: '"Time to hire" is NOT the key metric \u2014 all early career hires onboard in September regardless. The value is screening efficiency and candidate quality.'
      },
      assets: [
        { id:1, name:'Loriane Video Testimonial', status:'In Progress', note:'Paul-Louis arranging. ETA March 2026.' },
        { id:2, name:'GT France CHRO Endorsement', status:'Pending', note:'Paul-Louis getting CHRO name first.' },
        { id:3, name:'Executive Summary PPTX', status:'Ready', note:'7 slides with speaker notes.' },
        { id:4, name:'Battle Cards PPTX', status:'Ready', note:'3 hypothesis battle cards.' },
        { id:5, name:'Strategic Hypothesis Analysis', status:'Ready', note:'Full deep analysis document.' },
        { id:6, name:'Stakeholder Profiles DOCX', status:'Ready', note:'6 detailed profiles.' },
        { id:7, name:'Executive One-Pager', status:'Ready', note:'Client-facing Maki one-pager for GT.' },
        { id:8, name:'Org Map XLSX', status:'Ready', note:'29 contacts, 9 sheets, connection sequence.' }
      ]
    };
  }
  const pp = appData.proofPoints;
  let html = `<div class="metrics-grid" style="margin-bottom:20px;">`;
  pp.stats.forEach(s => {
    html += `<div class="proof-card">
      <div class="proof-stat" contenteditable="true" class="editable" style="${s.value.length > 5 ? 'font-size:24px;' : ''}" onblur="appData.proofPoints.stats.find(x=>x.id===${s.id}).value=this.textContent.trim();saveData()">${s.value}</div>
      <div class="proof-label" contenteditable="true" class="editable" onblur="appData.proofPoints.stats.find(x=>x.id===${s.id}).label=this.textContent.trim();saveData()">${s.label}</div>
    </div>`;
  });
  html += '</div>';

  html += `<div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
    <div class="card">
      <div class="card-header"><h3>France Case Study Data</h3></div>
      <div class="card-body">
        <div class="hyp-section"><h4>Challenge</h4><div contenteditable="true" class="editable" style="font-size:13px;color:#444;min-height:2em;line-height:1.6;" onblur="appData.proofPoints.caseStudy.challenge=this.textContent.trim();saveData()">${pp.caseStudy.challenge}</div></div>
        <div class="hyp-section"><h4>Solution</h4><div contenteditable="true" class="editable" style="font-size:13px;color:#444;min-height:2em;line-height:1.6;" onblur="appData.proofPoints.caseStudy.solution=this.textContent.trim();saveData()">${pp.caseStudy.solution}</div></div>
        <div class="hyp-section"><h4>Results</h4><div contenteditable="true" class="editable" style="font-size:13px;color:#444;min-height:2em;line-height:1.6;" onblur="appData.proofPoints.caseStudy.results=this.textContent.trim();saveData()">${pp.caseStudy.results}</div></div>
        <div class="hyp-section"><h4>Key Insight</h4><div contenteditable="true" class="editable" style="font-size:13px;color:#444;font-weight:500;min-height:2em;line-height:1.6;" onblur="appData.proofPoints.caseStudy.keyInsight=this.textContent.trim();saveData()">${pp.caseStudy.keyInsight}</div></div>
      </div>
    </div>
    <div class="card">
      <div class="card-header"><h3>Asset Inventory</h3></div>
      <div class="card-body">
        <div style="margin-bottom:12px;">
          ${pp.assets.map(a => {
            const statusClass = a.status==='Ready'?'badge-live':a.status==='In Progress'?'badge-researching':'badge-not-started';
            return `<div style="display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid rgba(0,0,0,0.04);">
            <div style="flex:1;">
              <div contenteditable="true" class="editable" style="font-size:13px;font-weight:500;" onblur="appData.proofPoints.assets.find(x=>x.id===${a.id}).name=this.textContent.trim();saveData()">${a.name}</div>
              <div contenteditable="true" class="editable" style="font-size:11px;color:#888;" onblur="appData.proofPoints.assets.find(x=>x.id===${a.id}).note=this.textContent.trim();saveData()">${a.note}</div>
            </div>
            <select class="edit-select" style="font-size:11px;" onchange="appData.proofPoints.assets.find(x=>x.id===${a.id}).status=this.value;saveData();renderProofPoints()">
              <option ${a.status==='Ready'?'selected':''}>Ready</option><option ${a.status==='In Progress'?'selected':''}>In Progress</option><option ${a.status==='Pending'?'selected':''}>Pending</option>
            </select>
          </div>`;}).join('')}
        </div>
        <button onclick="addAsset()" style="padding:4px 12px;background:var(--maki-purple);color:white;border:none;border-radius:var(--radius-xs);cursor:pointer;font-size:11px;font-weight:600;">+ Add Asset</button>
      </div>
    </div>
  </div>`;
  document.getElementById('proofPointsContent').innerHTML = html;
}

function addAsset() {
  const maxId = Math.max(...appData.proofPoints.assets.map(a => a.id), 0);
  appData.proofPoints.assets.push({ id: maxId+1, name:'New Asset', status:'Pending', note:'Description TBC' });
  saveData(); renderProofPoints();
}

// ===== BUILD 5: ACTIVITY TIMELINE =====
const defaultActivities = [
  { id:1, date:'2026-02-23', type:'Internal Note', contact:'Team', notes:'Internal strategy session: GT France confirmed as 3x renewed customer. Loriane identified as key contact. Paul-Louis managing relationship. Video testimonial being arranged.' },
  { id:2, date:'2026-02-23', type:'Internal Note', contact:'Team', notes:'Account plan created. Four-phase EMEA expansion strategy defined. Priority actions assigned.' },
];

let timelineFilter = 'all';

function addActivity() {
  if (!appData.activities) appData.activities = defaultActivities.map(a => ({...a}));
  const date = document.getElementById('actDate').value || new Date().toISOString().split('T')[0];
  const type = document.getElementById('actType').value;
  const contact = document.getElementById('actContact').value;
  const notes = document.getElementById('actNotes').value;
  if (!notes) { showToast('Please add notes'); return; }
  const maxId = Math.max(...appData.activities.map(a => a.id), 0);
  appData.activities.push({ id: maxId + 1, date, type, contact, notes });
  saveData();
  renderTimeline();
  document.getElementById('actContact').value = '';
  document.getElementById('actNotes').value = '';
  showToast('Activity added');
}

function filterTimeline(filter, btn) {
  timelineFilter = filter;
  if (btn) {
    btn.closest('.card-header').querySelectorAll('.org-filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
  }
  renderTimeline();
}

function deleteActivity(id) {
  appData.activities = appData.activities.filter(a => a.id !== id);
  saveData();
  renderTimeline();
}

function renderTimeline() {
  if (!appData.activities) appData.activities = defaultActivities.map(a => ({...a}));
  let items = [...appData.activities].sort((a,b) => b.date.localeCompare(a.date));
  if (timelineFilter !== 'all') items = items.filter(a => a.type === timelineFilter);

  if (items.length === 0) {
    document.getElementById('timelineList').innerHTML = '<div style="text-align:center;padding:40px;color:#aaa;">No activities recorded yet</div>';
    return;
  }

  const typeIcons = { 'Meeting':'\u{1F91D}', 'Email':'\u2709', 'LinkedIn':'\u{1F517}', 'Call':'\u260E', 'Internal Note':'\u{1F4DD}' };
  const typeClasses = { 'Meeting':'tl-meeting', 'Email':'tl-email', 'LinkedIn':'tl-linkedin', 'Call':'tl-call', 'Internal Note':'tl-note' };

  let html = '';
  items.forEach(a => {
    html += `<div class="timeline-item">
      <div class="tl-type-icon ${typeClasses[a.type] || 'tl-note'}">${typeIcons[a.type] || '\u{1F4CB}'}</div>
      <div class="tl-content">
        <div style="font-size:12px;font-weight:600;margin-bottom:2px;">${a.type}${a.contact ? ' \u2014 ' + a.contact : ''}</div>
        <div style="font-size:13px;color:#444;line-height:1.5;">${a.notes}</div>
      </div>
      <div class="tl-date">${a.date}</div>
      <div class="tl-delete" onclick="deleteActivity(${a.id})">\u00D7</div>
    </div>`;
  });
  document.getElementById('timelineList').innerHTML = html;
}

// ===== BUILD 5: ACTION PLAN =====
const defaultActions = [
  { phase: 1, phaseName: 'Arm the Proof', phaseColor: 'var(--maki-purple)', items: [
    { id:1, action:'Secure Loriane video testimonial', owner:'Paul-Louis', due:'Mar 2026', done:false },
    { id:2, action:'Get GT France CHRO name from Loriane', owner:'Paul-Louis', due:'Mar 2026', done:false },
    { id:3, action:'Package France case study (40-60% time savings, quality data)', owner:'Olly', due:'Mar 2026', done:false },
    { id:4, action:'Get CHRO endorsement quote for EMEA expansion', owner:'Paul-Louis', due:'Apr 2026', done:false },
    { id:5, action:'Research early career hiring volumes per GT country', owner:'Olly', due:'Mar 2026', done:false },
  ]},
  { phase: 2, phaseName: 'Win GT UK', phaseColor: 'var(--maki-purple-dark)', items: [
    { id:6, action:'LinkedIn connect + message Abigail Fisher', owner:'Marc', due:'Mar 2026', done:false },
    { id:7, action:'LinkedIn connect Ruth Walsh (Head of Talent Solutions)', owner:'Marc', due:'Mar 2026', done:false },
    { id:8, action:'LinkedIn connect Jenn Barnett (ED&I) for DEI angle', owner:'Marc', due:'Mar 2026', done:false },
    { id:9, action:'First meeting with Fisher \u2014 lead with H2 hypothesis', owner:'Marc', due:'Apr 2026', done:false },
    { id:10, action:'Discovery session with Ruth Walsh on early careers process', owner:'Marc', due:'Apr 2026', done:false },
    { id:11, action:'Propose early careers pilot (Shiro)', owner:'Marc', due:'May 2026', done:false },
    { id:12, action:'Pilot go-live at GT UK', owner:'Marc', due:'Jun 2026', done:false },
  ]},
  { phase: 3, phaseName: 'Parallel Expansion', phaseColor: 'var(--maki-black-grey)', items: [
    { id:13, action:'Approach Mia Gargan (Ireland) with France + UK proof', owner:'TBC', due:'Jul 2026', done:false },
    { id:14, action:'Approach Rens Oliemans (Netherlands)', owner:'TBC', due:'Jul 2026', done:false },
    { id:15, action:'Approach Silke Gonsior (Germany) \u2014 check EU AI Act compliance first', owner:'TBC', due:'Aug 2026', done:false },
    { id:16, action:'Approach Leslie Van den Branden (Belgium)', owner:'TBC', due:'Sep 2026', done:false },
    { id:17, action:'Target: 3 countries with active pilots by Dec 2026', owner:'Marc', due:'Dec 2026', done:false },
  ]},
  { phase: 4, phaseName: 'EMEA Platform Play', phaseColor: 'var(--maki-black)', items: [
    { id:18, action:'Approach Hilary Haynes with multi-country traction data', owner:'Marc', due:'Q1 2027', done:false },
    { id:19, action:'Propose GT Advisors platform-level assessment standard', owner:'Marc', due:'Q2 2027', done:false },
    { id:20, action:'Enterprise agreement covering 5+ countries', owner:'Marc', due:'Q3 2027', done:false },
  ]}
];

function renderActionPlan() {
  if (!appData.actions) appData.actions = JSON.parse(JSON.stringify(defaultActions));
  let html = '';
  appData.actions.forEach(phase => {
    html += `<div class="action-phase">
      <div class="action-phase-header" style="background:${phase.phaseColor};">Phase ${phase.phase}: ${phase.phaseName}</div>`;
    phase.items.forEach(item => {
      html += `<div class="action-item">
        <div class="action-check ${item.done?'done':''}" onclick="toggleAction(${phase.phase},${item.id})">${item.done?'\u2713':''}</div>
        <div contenteditable="true" class="editable" style="${item.done?'text-decoration:line-through;color:#aaa;':''}" onblur="updateAction(${phase.phase},${item.id},'action',this.textContent.trim())">${item.action}</div>
        <div contenteditable="true" class="editable" style="font-size:12px;font-weight:600;color:var(--maki-purple-dark);" onblur="updateAction(${phase.phase},${item.id},'owner',this.textContent.trim())">${item.owner}</div>
        <div contenteditable="true" class="editable" style="font-size:12px;color:#888;" onblur="updateAction(${phase.phase},${item.id},'due',this.textContent.trim())">${item.due}</div>
        <div style="display:flex;align-items:center;gap:4px;">
          <span class="badge ${item.done?'badge-live':'badge-not-started'}">${item.done?'Done':'Open'}</span>
          <span class="tl-delete" onclick="deleteAction(${phase.phase},${item.id})">\u00D7</span>
        </div>
      </div>`;
    });
    html += `<div style="padding:6px 16px;background:white;border:1px solid rgba(0,0,0,0.06);border-top:none;border-radius:0 0 var(--radius-sm) var(--radius-sm);">
      <button onclick="addAction(${phase.phase})" style="padding:3px 10px;background:none;border:1px dashed #ccc;border-radius:4px;cursor:pointer;font-size:11px;color:#888;">+ Add action</button>
    </div></div>`;
  });
  document.getElementById('actionPlanContent').innerHTML = html;
}

function toggleAction(phaseNum, itemId) {
  const phase = appData.actions.find(p => p.phase === phaseNum);
  if (phase) {
    const item = phase.items.find(i => i.id === itemId);
    if (item) { item.done = !item.done; saveData(); renderActionPlan(); }
  }
}

function updateAction(phaseNum, itemId, field, value) {
  const phase = appData.actions.find(p => p.phase === phaseNum);
  if (phase) {
    const item = phase.items.find(i => i.id === itemId);
    if (item) { item[field] = value; saveData(); }
  }
}

function deleteAction(phaseNum, itemId) {
  const phase = appData.actions.find(p => p.phase === phaseNum);
  if (phase) {
    phase.items = phase.items.filter(i => i.id !== itemId);
    saveData(); renderActionPlan();
  }
}

function addAction(phaseNum) {
  const phase = appData.actions.find(p => p.phase === phaseNum);
  if (phase) {
    const maxId = Math.max(...appData.actions.flatMap(p => p.items.map(i => i.id)), 0);
    phase.items.push({ id: maxId+1, action:'New action', owner:'TBC', due:'TBC', done:false });
    saveData(); renderActionPlan();
  }
}

// ===== BUILD 5: TEAM RACI =====
function renderRACI() {
  if (!appData.raci) {
    appData.raci = {
      team: ['Marc','Paul-Louis','Olly','Brianna'],
      rows: [
        { id:1, activity:'GT France relationship management', values:['C','R','I','I'] },
        { id:2, activity:'Loriane video testimonial', values:['I','R','C','I'] },
        { id:3, activity:'GT France CHRO endorsement', values:['C','R','I','I'] },
        { id:4, activity:'UK senior stakeholder engagement (Fisher, Walsh)', values:['R','C','A','I'] },
        { id:5, activity:'UK early careers pilot execution', values:['R','C','A','C'] },
        { id:6, activity:'LinkedIn outreach sequence (UK)', values:['R','I','I','C'] },
        { id:7, activity:'France case study packaging', values:['A','C','R','C'] },
        { id:8, activity:'Early career volume research (all countries)', values:['A','C','R','R'] },
        { id:9, activity:'Bi-weekly GT cadence meetings', values:['C','R','R','R'] },
        { id:10, activity:'Ireland expansion approach', values:['A','C','R','I'] },
        { id:11, activity:'Netherlands expansion approach', values:['A','I','R','I'] },
        { id:12, activity:'Germany expansion approach', values:['A','I','R','C'] },
        { id:13, activity:'GT Advisors platform-level engagement', values:['R','I','A','I'] },
        { id:14, activity:'Competitive intelligence updates', values:['I','C','R','R'] },
        { id:15, activity:'Account plan maintenance & updates', values:['A','C','R','C'] },
      ]
    };
  }
  const r = appData.raci;
  const raciClass = v => v==='R'?'raci-r':v==='A'?'raci-a':v==='C'?'raci-c':v==='I'?'raci-i':'';
  const raciCycle = ['R','A','C','I','-'];

  let html = `<div class="card"><div class="card-body" style="padding:0;overflow-x:auto;">
    <div style="padding:16px 22px;background:var(--maki-grey-light);border-bottom:1px solid rgba(0,0,0,0.06);">
      <span class="raci-r" style="margin-right:16px;">R = Responsible (click to cycle)</span>
      <span class="raci-a" style="margin-right:16px;">A = Accountable</span>
      <span class="raci-c" style="margin-right:16px;">C = Consulted</span>
      <span class="raci-i">I = Informed</span>
    </div>
    <table class="raci-table">
      <thead><tr><th style="min-width:280px;">Activity</th>${r.team.map((t,i) => `<th contenteditable="true" class="editable" onblur="appData.raci.team[${i}]=this.textContent.trim();saveData()">${t}</th>`).join('')}<th></th></tr></thead>
      <tbody>`;
  r.rows.forEach(row => {
    html += `<tr>
      <td contenteditable="true" class="editable" onblur="appData.raci.rows.find(x=>x.id===${row.id}).activity=this.textContent.trim();saveData()">${row.activity}</td>`;
    row.values.forEach((v, i) => {
      html += `<td class="${raciClass(v)}" style="cursor:pointer;user-select:none;" onclick="cycleRaci(${row.id},${i})">${v}</td>`;
    });
    html += `<td><span class="tl-delete" onclick="deleteRaciRow(${row.id})">\u00D7</span></td></tr>`;
  });
  html += `</tbody></table>
    <div style="padding:12px 22px;"><button onclick="addRaciRow()" style="padding:4px 12px;background:none;border:1px dashed #ccc;border-radius:4px;cursor:pointer;font-size:11px;color:#888;">+ Add activity</button></div>
  </div></div>`;
  document.getElementById('raciContent').innerHTML = html;
}

function cycleRaci(rowId, colIdx) {
  const cycle = ['R','A','C','I','-'];
  const row = appData.raci.rows.find(x => x.id === rowId);
  if (row) {
    const cur = cycle.indexOf(row.values[colIdx]);
    row.values[colIdx] = cycle[(cur + 1) % cycle.length];
    saveData(); renderRACI();
  }
}

function addRaciRow() {
  const maxId = Math.max(...appData.raci.rows.map(r => r.id), 0);
  appData.raci.rows.push({ id: maxId+1, activity:'New activity', values: appData.raci.team.map(() => '-') });
  saveData(); renderRACI();
}

function deleteRaciRow(id) {
  appData.raci.rows = appData.raci.rows.filter(r => r.id !== id);
  saveData(); renderRACI();
}

// ===== DASHBOARD ACTIONS =====
function renderDashboardActions() {
  if (!appData.dashboardActions) {
    appData.dashboardActions = [
      { id:1, action:'Get Loriane video testimonial confirmed', owner:'Paul-Louis', due:'Mar 2026', priority:'high' },
      { id:2, action:'LinkedIn connect Abigail Fisher (new CPO)', owner:'Marc', due:'Mar 2026', priority:'high' },
      { id:3, action:'Get GT France CHRO name from Loriane', owner:'Paul-Louis', due:'Mar 2026', priority:'high' },
      { id:4, action:'Research UK early careers hiring volumes', owner:'Olly', due:'Mar 2026', priority:'medium' },
      { id:5, action:'LinkedIn connect Ruth Walsh (Head of Talent Solutions)', owner:'Marc', due:'Mar 2026', priority:'medium' }
    ];
  }
  const priorityColors = { high:'#ef4444', medium:'#f59e0b', low:'#22c55e' };
  let html = '<table style="width:100%;border-collapse:collapse;">';
  html += '<tr style="background:var(--maki-grey-light);"><th style="text-align:left;padding:10px 16px;font-size:10px;text-transform:uppercase;letter-spacing:0.5px;color:#888;font-weight:600;">Action</th><th style="padding:10px;font-size:10px;text-transform:uppercase;letter-spacing:0.5px;color:#888;font-weight:600;width:100px;">Owner</th><th style="padding:10px;font-size:10px;text-transform:uppercase;letter-spacing:0.5px;color:#888;font-weight:600;width:90px;">Due</th><th style="padding:10px;font-size:10px;text-transform:uppercase;letter-spacing:0.5px;color:#888;font-weight:600;width:80px;">Priority</th><th style="width:30px;"></th></tr>';
  appData.dashboardActions.forEach(a => {
    html += `<tr style="border-bottom:1px solid rgba(0,0,0,0.04);">
      <td style="padding:10px 16px;"><div contenteditable="true" class="editable" style="font-size:13px;" onblur="updateDashAction(${a.id},'action',this.textContent.trim())">${a.action}</div></td>
      <td style="padding:10px;text-align:center;"><div contenteditable="true" class="editable" style="font-size:12px;font-weight:600;color:var(--maki-purple-dark);" onblur="updateDashAction(${a.id},'owner',this.textContent.trim())">${a.owner}</div></td>
      <td style="padding:10px;text-align:center;"><div contenteditable="true" class="editable" style="font-size:12px;color:#888;" onblur="updateDashAction(${a.id},'due',this.textContent.trim())">${a.due}</div></td>
      <td style="padding:10px;text-align:center;"><select class="edit-select" style="font-size:11px;" onchange="updateDashAction(${a.id},'priority',this.value);renderDashboardActions()">
        <option value="high" ${a.priority==='high'?'selected':''}>High</option><option value="medium" ${a.priority==='medium'?'selected':''}>Medium</option><option value="low" ${a.priority==='low'?'selected':''}>Low</option>
      </select></td>
      <td><span class="tl-delete" onclick="deleteDashAction(${a.id})">\u00D7</span></td>
    </tr>`;
  });
  html += '</table>';
  html += '<div style="padding:8px 16px;"><button onclick="addDashAction()" style="padding:3px 10px;background:none;border:1px dashed #ccc;border-radius:4px;cursor:pointer;font-size:11px;color:#888;">+ Add action</button></div>';
  document.getElementById('dashboardActions').innerHTML = html;
}

function updateDashAction(id, field, value) {
  const a = appData.dashboardActions.find(x => x.id === id);
  if (a) { a[field] = value; saveData(); }
}

function deleteDashAction(id) {
  appData.dashboardActions = appData.dashboardActions.filter(x => x.id !== id);
  saveData(); renderDashboardActions();
}

function addDashAction() {
  const maxId = Math.max(...appData.dashboardActions.map(a => a.id), 0);
  appData.dashboardActions.push({ id: maxId+1, action:'New action', owner:'TBC', due:'TBC', priority:'medium' });
  saveData(); renderDashboardActions();
}

// ===== INIT =====
loadData();
renderDashboardActions();
renderOrgMap();
renderCountryTracker();
renderRevenueModel();
renderHypotheses();
renderCallPrep();
renderRiskRegister();
renderCompetitive();
renderProofPoints();
renderTimeline();
renderActionPlan();
renderRACI();
document.getElementById('lastSaved').textContent = appData.lastUpdated ? new Date(appData.lastUpdated).toLocaleString() : 'Never';
document.getElementById('actDate').value = new Date().toISOString().split('T')[0];

// Add floating action button for adding contacts on org map page
const fab = document.createElement('div');
fab.innerHTML = '+';
fab.style.cssText = 'position:fixed;bottom:32px;right:32px;width:48px;height:48px;background:var(--maki-purple);color:white;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;cursor:pointer;box-shadow:0 4px 12px rgba(88,69,194,0.4);z-index:200;transition:all 0.2s ease;';
fab.onmouseenter = () => fab.style.transform = 'scale(1.1)';
fab.onmouseleave = () => fab.style.transform = 'scale(1)';
fab.onclick = addContact;
document.body.appendChild(fab);
</script>
</body>
</html>
